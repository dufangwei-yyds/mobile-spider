##### é¡¹ç›®ä»‹ç»
1. é¡¹ç›®æ¦‚è¿°

   ```markdown
   æ•°æ®æŠ“å–,æ•°æ®å­˜å‚¨,æ•°æ®å¯è§†åŒ–å®Œæ•´å®æˆ˜æµç¨‹
   ```

2. é¡¹ç›®ç›®æ ‡

   ```markdown
   å­¦ä¼šuiautomator2å¯¹ç§»åŠ¨è®¾å¤‡è¿›è¡Œæ“æ§
   å­¦ä¼šæŠ“åŒ…åˆ©å™¨ä½¿ç”¨
   å­¦ä¼šåˆ©ç”¨pythonç¼–å†™ç§»åŠ¨ç«¯è‡ªåŠ¨åŒ–æŠ“å–è„šæœ¬
   å­¦ä¼šé€šè¿‡atxserver2ç›‘æ§å¤šå°ç§»åŠ¨è®¾å¤‡
   å­¦ä¼šå°†æ•°æ®å­˜å‚¨åˆ°es
   å­¦ä¼šé€šè¿‡kibanaè¿›è¡Œå¤§æ•°æ®å¯è§†åŒ–åˆ†æå±•ç¤º
   ```

3. çˆ¬å–æ•°æ®å,èƒ½åšä»€ä¹ˆ

   ```markdown
   æ•°æ®åˆ†æ
   ç”¨æˆ·ç”»åƒ
   ç»Ÿè®¡ç³»ç»Ÿ
   å•†ä¸šç«äº‰

   æŠ€èƒ½æå‡
   é¢è¯•å¿…å¤‡
   ```

4. appæ•°æ®å¥½æŠ“å—?

   ```markdown
   ç®€å•: appé‡Œçš„æ•°æ®æ¯”webç«¯æ›´å®¹æ˜“æŠ“å–,åçˆ¬è™«ä¹Ÿæ²¡é‚£ä¹ˆå¼º,å¤§éƒ¨åˆ†ä¹Ÿéƒ½æ˜¯http/httpsåè®®,
   è¿”å›çš„æ•°æ®ç±»å‹å¤§å¤šæ•°ä¸ºjson
   å›°éš¾: 
   å¯èƒ½éœ€è¦é€‚å½“çš„åç¼–è¯‘,åˆ†æå‡ºåŠ å¯†ç®—æ³•å¹¶æŠ“å–åˆ°ä¿¡æ¯;
   å¯èƒ½åŠ å›º,éœ€è¦è„±å£³,ç„¶ååç¼–è¯‘,åˆ†æå‡ºåŠ å¯†ç®—æ³•å¹¶æŠ“å–åˆ°ä¿¡æ¯;
   éœ€è¦ç ´è§£é€šè¿‡å„å¼å„æ ·çš„ç­¾å,è¯ä¹¦,è®¾å¤‡ç»‘å®šç­‰æ–¹æ³•,æ‰¾åˆ°éšè—åŠ å¯†ç®—æ³•
   ```

5. çˆ¬è™«å·¥ç¨‹å¸ˆæŠ€æœ¯å‚¨å¤‡

   ```markdown
   pythonçˆ¬è™«å¼€å‘ç»éªŒ
   javaå¼€å‘åŸºç¡€
   androidå¼€å‘åŸºç¡€
   appé€†å‘
   appè„±å£³
   ç ´è§£åŠ å¯†ç®—æ³•
   ```

6. é¡¹ç›®å†…å®¹

   ```markdown
   # é¡¹ç›®å†…å®¹V1
   python <=appium=> android
   
   python å¤œç¥æ¨¡æ‹Ÿå™¨/genymotion fiddler/mitmproxy/Packet Capture appium docker
   è±†æœç¾é£Ÿ æŠ–éŸ³ å¿«æ‰‹ ä»Šæ—¥å¤´æ¡ mongoDB
                                                        docker appium <-httpé€šè®¯-> æŠ–éŸ³
   mongodb =pymongodb=> appium-python-client =httpé€šè®¯=> docker appium <-httpé€šè®¯-> å¿«æ‰‹
                                                        docker appium <-httpé€šè®¯-> ä»Šæ—¥å¤´æ¡                                         
   
   # é¡¹ç›®å†…å®¹V2
   uiautomator2
   weditor fiddler mitmproxy ...
   æŠ–éŸ³ atxserver2 es  kibana
   
   kibana      atxserver2å¤šè®¾å¤‡ç›‘æ§å¹³å°-httpé€šä¿¡-> Atx-agent(ç§»åŠ¨è®¾å¤‡) -httpé€šä¿¡-> æ–°é—»ä¿¡æ¯
   es            æ‰‹æœºå±å¹•ç›‘æ§          -httpé€šä¿¡-> Atx-agent(ç§»åŠ¨è®¾å¤‡) -httpé€šä¿¡->çŸ­è§†é¢‘ä¿¡æ¯
                                     -httpé€šä¿¡-> Atx-agent(ç§»åŠ¨è®¾å¤‡) -httpé€šä¿¡->ç§Ÿæˆ¿ä¿¡æ¯
   ```
   
##### u2è‡ªåŠ¨åŒ–æŠ“å–å¼€å‘ç¯å¢ƒæ­å»º
1. å¤œç¥æ¨¡æ‹Ÿå™¨å®‰è£…ã€ä»‹ç»ã€è®¾ç½®ã€å®‰è£…app

   ```markdown
   # å¸¸è§å®‰å“å¼€å‘æ¨¡æ‹Ÿå™¨å¯¹æ¯”
   æ¨¡æ‹Ÿå™¨åç§°        æ”¯æŒçš„æ“ä½œç³»ç»Ÿ   æ”¯æŒçš„è™šæ‹Ÿæœº è¿è¡Œé€Ÿåº¦  å®‰è£…apkæ–¹å¼ æ”¯æŒæœºå‹ è°ƒè¯•éš¾æ˜“ç¨‹åº¦
   googleå®˜æ–¹çš„avd   Win/Linux      QEMU       æ…¢      adb       å¤š       å¤æ‚
   genumotion       Win/Wac/Winux  VirtualBox ä¸€èˆ¬    adb/æ‹–æ‹½   å°‘       ä¸€èˆ¬
   å¤œç¥æ¨¡æ‹Ÿå™¨         Win            VirtualBox å¿«     adb/æ‹–æ‹½    å°‘       ç®€å•
   
   # å¤œæ·±å®‰å“æ¨¡æ‹Ÿå™¨
   å¤œæ·±å®‰å“æ¨¡æ‹Ÿå™¨(å¤œç¥æ¨¡æ‹Ÿå™¨),æ˜¯å…¨æ–°ä¸€ä»£çš„å®‰å“æ¨¡æ‹Ÿå™¨,ä¸ä¼ ç»Ÿå®‰å“æ¨¡æ‹Ÿå™¨ç›¸æ¯”,åŸºäºandroid4.4.2,
   å…¼å®¹X68/AMD,åœ¨æ€§èƒ½ã€ç¨³å®šæ€§ã€å…¼å®¹æ€§ç­‰æ–¹é¢æœ‰ç€å·¨å¤§ä¼˜åŠ¿
   https://www.yeshen.com
   å¤šå¼€ 
   è®¾ç½®: root  æ‰‹æœºå‹å·  ç½‘ç»œè®¾ç½®
   å®‰è£…app: adbã€æ‹–æ‹½
   è±†æœç¾é£Ÿapk æŠ–éŸ³apk è€ƒç ”å¸®apk æ…•è¯¾ç½‘apk
   ```

2. appiumç§»åŠ¨ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·å®‰è£…åŠä»‹ç»

   ```markdown
   # appiumç§»åŠ¨ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ä»‹ç»
   appiumæ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•å¼€æºå·¥å…·,æ”¯æŒioså¹³å°å’Œandroidå¹³å°ä¸Šçš„åŸç”Ÿåº”ç”¨,webåº”ç”¨å’Œæ··åˆåº”ç”¨
   appiumæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„å·¥å…·: å®ƒå…è®¸æµ‹è¯•äººå‘˜åœ¨ä¸åŒçš„å¹³å°(ios,android)ä½¿ç”¨åŒä¸€å¥—APIæ¥å†™è‡ªåŠ¨åŒ–
   æµ‹è¯•è„šæœ¬,è¿™æ ·å¤§å¤§å¢åŠ äº†ioså’Œandroidæµ‹è¯•å¥—ä»¶é—´ä»£ç çš„å¤ç”¨æ€§
   
   # selenium
   appiumç±»åº“å°è£…æ ‡å‡†Seleniumå®¢æˆ·ç«¯ç±»åº“
   appiumå®¢æˆ·ç«¯ç±»åº“å®ç°Mobile JSON Wire Protocolã€W3C
   appiumæœåŠ¡ç«¯å®šä¹‰äº†å®˜æ–¹åè®®çš„æ‰©å±•,ä¸ºappiumç”¨æˆ·æä¾›æ–¹ä¾¿çš„æ¥å£æ¥æ‰§è¡Œå„ç§è®¾å¤‡æ“ä½œ
   
   # appiumç‰¹ç‚¹
   å¤šå¹³å°
   appiumé€‰æ‹©äº†client/serverçš„è®¾è®¡æ¨¡å¼
   appiumæ‰©å±•äº†WebDriverçš„åè®®
   å¤šè¯­è¨€
   
   # appiumå·¥ä½œåŸç†
   Appium-client =>  Appium-Server       => ç§»åŠ¨è®¾å¤‡
   Java-client      appium.dmg              Androidæ¨¡æ‹Ÿå™¨
   Python-client    appiumForWindow.zip     AndroidçœŸæœº
   Ruby-cli                                 iOSçœŸæœº
   ...
   
   # appiumä¸‹è½½å®‰è£…
   appium-1.9.0 (æœåŠ¡ç«¯)
   https://github.com/appium/appium-desktop/releases?page=1
   0.0.0.0 4723  => start server v1.9.0
   ğŸ” => start session
   
   é€šè¿‡node.jså®‰è£…-ä¸æ¨è: 
   npm install -g appium
   win10å¼€å‘è€…æ¨¡å¼
   .net3.5
   windows-10-sdkå·¥å…·
   WindowsApplicationDriver
   npm install --global --production windows-build-tools
   https://testerhome.com/topics/12988
   
   # appium
   appiumæ˜¯ä¸€ä¸ªå¼€æºæµ‹è¯•è‡ªåŠ¨åŒ–æ¡†æ¶,å¯ç”¨äºåŸç”Ÿ,æ··åˆå’Œç§»åŠ¨webåº”ç”¨ç¨‹åºæµ‹è¯•.å®ƒä½¿ç”¨WebDriveråè®®é©±åŠ¨iOS,
   Androidåº”ç”¨ç¨‹åº 
   
   # appiumæ¶æ„
   # appium-inspector
   Configurationé…ç½®ç¯å¢ƒå˜é‡: ANDROID_HOMEå’ŒJAVA_HOME
   adb connect 127.0.0.1:62001
   Remote Path: /wd/hub
   Automatic Server - Desired Capabilities
   platformName text Android
   platformVersion text  7.1.2
   deviceName text 127.0.0.1:62001
   appPackage text com.tal.kaoyan
   appActivity text com.tal.kaoyan.ui.activity.SplashActivity
   noReset true
   save as kaoyanbang2
   Saved Capability Sets-é€‰ä¸­kaoyanbang2-start session
   ç‚¹å‡»ğŸ‘€ ç‚¹å‡»Send Keys è¾“å…¥ç”¨æˆ·å
   ç‚¹å‡»Send Keys è¾“å…¥å¯†ç 
   ç‚¹å‡»Tap
   ç‚¹å‡»åˆ·æ–°æŒ‰é’®
   
   aapt dump badging apkæ–‡ä»¶å
   aapt dump badging apkæ–‡ä»¶å | find "launchable-activity"
   adb shell
   logcat | grep cmp=
   ç‚¹å‡»è€ƒç ”å¸®
   
   # Desired Capability
   Desired Capabilityçš„åŠŸèƒ½æ˜¯é…ç½®Appiumä¼šè¯,ä»–ä»¬å‘Šè¯‰AppiumæœåŠ¡å™¨æƒ³è¦è‡ªåŠ¨åŒ–çš„å¹³å°å’Œåº”ç”¨ç¨‹åº
   
   # appiumå®æˆ˜
   pip3 install Appium-Python-Client
   kaoyanbang_test.py
   ```
   ![](/Users/bruce/Documents/ç¬”è®°æˆªå›¾/appiumæ¶æ„.png)

3. Androidå¼€å‘å·¥å…·ç¯å¢ƒå®‰è£…

   ```markdown
   # ä»€ä¹ˆæ˜¯SDK
   SDK: software development kit è½¯ä»¶å¼€å‘å·¥å…·åŒ….æ˜¯è½¯ä»¶å¼€å‘å·¥ç¨‹å¸ˆç”¨äºä¸ºç‰¹å®šçš„è½¯ä»¶åŒ…ã€è½¯ä»¶æ¡†æ¶
   ç¡¬ä»¶å¹³å°ã€æ“ä½œç³»ç»Ÿç­‰å»ºç«‹åº”ç”¨è½¯ä»¶çš„å¼€å‘å·¥å…·çš„é›†åˆ
   Android SDKæŒ‡çš„æ˜¯Androidä¸“å±çš„è½¯ä»¶å¼€å‘å·¥å…·åŒ…
   
   # å®‰è£…SDKå‰å‡†å¤‡å·¥ä½œ
   å®‰è£…JDKå¹¶é…ç½®ç¯å¢ƒå˜é‡
   
   # SDKä¸‹è½½å®‰è£…å¹¶é…ç½®ç¯å¢ƒå˜é‡
   http://tools.android-studio.org/index.php/sdk
   cd /Users/bruce/android-sdk-macosx/tools
   android -v
   SDK Manager
   Tools => Options => Proxy Settings mirrors.neusoft.edu.cn 80
   => Others Force...æ‰“âœ…
   Packages => Reload
   Tools: Android SDK Tools,Android SDK Platform-tools,Android SDK Build-tools
   Extras: å…¨éƒ¨â˜‘ï¸
   Install 23 packages
   
   # Androidå¼€å‘å·¥å…·ä½¿ç”¨
   adb 5037
   adb version
   adb devices
   adb -s 127.0.0.1:62001  shell
   # æœ‰rootæƒé™
   $ æ²¡æœ‰rootæƒé™
   adb -s è®¾å¤‡  install apkå®‰è£…åŒ…è·¯å¾„
   adb -s è®¾å¤‡ shell
   cd /data/app
   adb -s è®¾å¤‡  uninstall åŒ…å
   adb connect 127.0.0.1:62001
   adb shell pm list package
   adb push æœ¬åœ°æ–‡ä»¶è·¯å¾„  å¤œç¥æ¨¡æ‹Ÿå™¨è·¯å¾„
   adb pull å¤œç¥æ¨¡æ‹Ÿå™¨è·¯å¾„ æœ¬åœ°æ–‡ä»¶è·¯å¾„
   adb shell screencap å¤œç¥æ¨¡æ‹Ÿå™¨è·¯å¾„
   
   uiautomator
   Android4.3å‘å¸ƒçš„æµ‹è¯•å·¥å…·
   uiautomatoræ˜¯ç”¨æ¥åšUIæµ‹è¯•çš„,å³æ™®é€šçš„æ‰‹å·¥æµ‹è¯•,ç‚¹å‡»æ¯ä¸ªæ§ä»¶å…ƒç´ çœ‹è¾“å‡ºçš„ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸ
   uiautomator: ä¸€ä¸ªæµ‹è¯•çš„Javaåº“,åŒ…å«äº†åˆ›å»ºUIæµ‹è¯•çš„å„ç§APIå’Œæ‰§è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•çš„å¼•æ“
   uiautomatorviewer: ä¸€ä¸ªå›¾å½¢ç•Œé¢å·¥å…·æ¥æ‰«æå’Œåˆ†æåº”ç”¨çš„UIæ§ä»¶,å­˜åœ¨åœ¨toolsç›®å½•
   
   uiautomatorviewerå‡çº§ç‰ˆ
   ç›¸å…³æ–‡ä»¶æ›¿æ¢: 
   cd /d/SDK/tools/lib
   uiautomatorviewer.jar 
   libä¸­æ‰€æœ‰æ–‡ä»¶ 
   cd /d/SDK/tools
   comã€imageä¸­æ‰€æœ‰æ–‡ä»¶
   
   uiautomatorviewerè¿æ¥è®¾å¤‡ä½¿ç”¨
   å¯åŠ¨å¤œç¥æ¨¡æ‹Ÿå™¨
   cd /d/SDK/platform-tools
   ./adb.exe connect 127.0.0.1:62001
   cd /d/SDK/tools
   uiautomatorviewer.bat
   ```

4. u2è‡ªåŠ¨åŒ–æŠ“å–å·¥å…·æ¦‚è¿°

   ```markdown
   # UiAutomator
   UiAutomatoræ˜¯Googleæä¾›çš„ç”¨æ¥åšå®‰å“è‡ªåŠ¨åŒ–æµ‹è¯•çš„ä¸€ä¸ªJavaåº“
   åŸºäºAccessibilityæœåŠ¡

   è¾…åŠ©åŠŸèƒ½(AccessibilityService)æ˜¯Androidç³»ç»Ÿæä¾›ç»™çš„ä¸€ç§æœåŠ¡,æœ¬èº«æ˜¯ç»§æ‰¿Serviceç±»çš„,è¿™ä¸ªæœåŠ¡æä¾›äº†å¢å¼ºçš„ç”¨æˆ·ç•Œé¢,
   æ—¨åœ¨å¸®åŠ©æ®‹éšœäººå£«æˆ–è€…å¯èƒ½æ— æ³•ä¸è®¾å¤‡å……åˆ†äº¤äº’çš„äººä»¬
   æˆ‘ä»¬å¯ä»¥å€ŸåŠ©AccessibilityService,å¯ä»¥å®ç°å¯¹é¡µé¢çš„ç›‘å¬åŠæ¨¡æ‹Ÿç‚¹å‡»æ§åˆ¶ç­‰è‡ªåŠ¨åŒ–æ“ä½œ

   ç¼ºç‚¹:
   æµ‹è¯•è„šæœ¬åªèƒ½ä½¿ç”¨Javaè¯­è¨€
   æµ‹è¯•è„šæœ¬è¦æ‰“åŒ…æˆjaræˆ–apkåŒ…ä¸Šä¼ åˆ°è®¾å¤‡ä¸Šæ‰èƒ½è¿è¡Œ

   # UiAutomator2
   å¸Œæœ›èƒ½å¤Ÿç”¨Pythonç¼–å†™ä»£ç é€»è¾‘
   å¸Œæœ›èƒ½å¤Ÿåœ¨ç”µè„‘ä¸Šè¿è¡Œçš„æ—¶å€™å°±æ§åˆ¶æ‰‹æœº
   åœ¨æ‰‹æœºä¸Šè¿è¡Œäº†ä¸€ä¸ªhttp rpcæœåŠ¡,å°†UiAutomatorä¸­çš„åŠŸèƒ½é›†æˆè¿›æ¥,ç„¶åå†å°†è¿™äº›httpæ¥å£å°è£…æˆPythonåº“

   ä¼˜ç‚¹:
   ç¯å¢ƒæ­å»ºä¾¿æ·
   UIæ§ä»¶è¯†åˆ«æœ‰ä¸“ä¸šå·¥å…·(webitor),å¯è§†åŒ–å¥½
   UIè‡ªåŠ¨åŒ–ç¼–å†™é‡‡ç”¨python,å­¦ä¹ æˆæœ¬ä½
   UIè‡ªåŠ¨åŒ–è„šæœ¬è¿è¡Œç¨³å®š
   æ–‡æ¡£æ˜¯ä¸­æ–‡çš„

   https://github.com/openatx/uiautomator2

   uiautomator2æ”¯æŒçš„ç¯å¢ƒ: androidç‰ˆæœ¬4.4+ python3.6
   
   è¯¾ç¨‹å¼€å‘ç¯å¢ƒ:
   å¼€å‘ç¯å¢ƒ win10
   è¿è¡Œç¯å¢ƒ ubuntu18.04
   vmware workstation 15 pro
   securecrt version 7.0.0
   pycharm
   å®‰å“æ¨¡æ‹Ÿå™¨ å¤œç¥æ¨¡æ‹Ÿå™¨V6.6.0
   python3.6.9
   ```

5. u2é€šä¿¡æµç¨‹æ¦‚è¿°

   ```markdown
   # uiautomator2
   python      wifi/usb/adb wifi         ç§»åŠ¨è®¾å¤‡ uiautomator-server atx-agent minicap minitouch
   PCç«¯

   è¿è¡Œè„šæœ¬,å¹¶å‘ç³»ç»Ÿè®¾å¤‡å‘é€httpè¯·æ±‚          ç§»åŠ¨è®¾å¤‡ä¸Šè¿è¡Œå°è£…äº†uiautomator2çš„httpæœåŠ¡,è§£ææ”¶åˆ°çš„è¯·æ±‚,
                                         å¹¶è½¬åŒ–æˆuiautomator2çš„ä»£ç 

   # uiautomator
   åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå®‰è£…atx-agent(å®ˆæŠ¤è¿›ç¨‹),éšåatx-agentå¯åŠ¨uiautomator2æœåŠ¡(é»˜è®¤7912ç«¯å£)è¿›è¡Œç›‘å¬
   åœ¨pcä¸Šç¼–å†™æµ‹è¯•è„šæœ¬å¹¶æ‰§è¡Œ(ç›¸å½“äºå‘é€httpè¯·æ±‚åˆ°ç§»åŠ¨è®¾å¤‡çš„serverç«¯)
   ç§»åŠ¨è®¾å¤‡é€šè¿‡wifiæˆ–usbæ”¶åˆ°pcä¸Šå‘æ¥çš„httpè¯·æ±‚,æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œ

   u2_post.py
   adb devices
   adb shell
   ps | grep atx
   busybox netstat -pt | grep 7956
   ```

6. u2è‡ªåŠ¨åŒ–æŠ“å–å¼€å‘ç¯å¢ƒæ­å»º

   ```markdown
   # VMware WorkStationå¯¼å…¥è™šæ‹Ÿæœº,å®‰è£…SecureCrtè¿æ¥æœåŠ¡å™¨
   VMware WorkStationå¯¼å…¥ubuntuè™šæ‹Ÿæœºæ–‡ä»¶ (4g 2 20g | user1 imooc-python)
   netstat -an | grep 22
   ifconfig   
   
   # é…ç½®pycharmè¿œç¨‹å¼€å‘ç¯å¢ƒ
   win10ç¼–å†™ä»£ç ,ä»£ç è¿è¡Œåœ¨ubuntu,é…ç½®pycharmè¿æ¥ubuntu,å¯ä»¥åœ¨win10ä¸­ä½¿ç”¨ubuntuçš„pythonç¯å¢ƒ

   1) æœåŠ¡å™¨é…ç½®Pythonè™šæ‹Ÿç¯å¢ƒ
   pip3 uninstall virtualenv
   pip3 install virtualenv==20.0.23 -i https://pypi.douban.com/simple
   mkdir u2_project
   python3 -m virtualenv venv
   pip3 freeze
   source venv/bin/activate
   
   2) pycharm
   Python Interpreter => Add Interpreter => On SSH 
   => Connecting to SSH server(New-Host/Port/Username) 
   => Password 
   => Location(æœåŠ¡å™¨å·¥ä½œç›®å½•)|Base Interpreter(æœåŠ¡å™¨Pythonè™šæ‹Ÿç¯å¢ƒ)|Sync folders
   
   # androidè°ƒè¯•æ¡¥(adb)
   å‘½ä»¤è¡Œçª—å£,ç”¨äºé€šè¿‡ç”µè„‘ç«¯ä¸æ¨¡æ‹Ÿå™¨æˆ–è®¾å¤‡ä¹‹é—´çš„äº¤äº’
   
   adb client: å‘½ä»¤è¡Œç¨‹åº"adb"ç”¨äºä»shellæˆ–è„šæœ¬ä¸­è¿è¡Œadbå‘½ä»¤
   adb server: ADB Serveræ˜¯è¿è¡Œåœ¨pcä¸Šçš„ä¸€ä¸ªåå°ç¨‹åº
   adbd: ç¨‹åº"adbd"ä½œä¸ºä¸€ä¸ªåå°è¿›ç¨‹åœ¨Androidè®¾å¤‡æˆ–æ¨¡æ‹Ÿå™¨ç³»ç»Ÿä¸­è¿è¡Œ
   
   adbèƒ½å¤Ÿç”¨æ¥åšä»€ä¹ˆ:
   å®‰è£…å¸è½½apkã€ç§»åŠ¨è®¾å¤‡å’Œpcä¹‹é—´æ‹·è´æ–‡ä»¶ã€æŸ¥çœ‹è®¾å¤‡ä¸Šå®‰è£…çš„åº”ç”¨ä¿¡æ¯ã€æ–‡ä»¶ç®¡ç†ã€æŒ‰é”®æ“ä½œ...
   
   å¸¸è§adbåº”ç”¨: å„ç§åˆ·æœºå·¥å…·ã€å„ç§æ‰‹æœºrootå·¥å…·
   
   # Mac/Win10ç³»ç»Ÿå®‰è£…ä½¿ç”¨adb(å®‰è£…å¤œç¥æ¨¡æ‹Ÿå™¨å³å¯ä½¿ç”¨)
   1) å®‰è£…å¤œç¥æ¨¡æ‹Ÿå™¨
   2) Macé…ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡
   export NOXAPPPLAYER_HOME=/Applications/NoxAppPlayer.app/Contents
   export PATH=$PATH:$NOXAPPPLAYER_HOME/MacOS
   3) Win10é…ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡
   NOX_HOME=D:\Program Files\Nox
   Path=D:\Program Files\Nox\bin
   4) adbåŸºæœ¬ä½¿ç”¨(é€šè¿‡è±Œè±†èšæå‰å®‰è£…ç›¸å…³apkæ–‡ä»¶)
   adb devices
   adb kill-server
   adb install apkå®‰è£…åŒ…è·¯å¾„
   adb install apkå®‰è£…åŒ…è·¯å¾„
   adb shell pm list packages
   adb uninstall com.tal.kaoyan
   adb tcpip 5555
   adb connect 192.168.0.103
   adb shell
   
   5) æ³¨æ„äº‹é¡¹
   ä¸å»ºè®®ä½¿ç”¨çš„æ‰‹æœºå“ç‰Œ: åä¸ºç³»åˆ—ã€è£è€€ç³»åˆ—
   å»ºè®®ä½¿ç”¨çš„æ‰‹æœºå“ç‰Œ: å°ç±³ã€oppoç­‰
   
   # Ubuntuç³»ç»Ÿå®‰è£…ä½¿ç”¨adb
   1) ä¸‹è½½å®‰è£…platform-tools-latest-linux.zipã€adbã€fastboot
   wget https://dl.google.com/android/repository/platform-tools-latest-linux.zip
   sudo wget -O 
   /usr/local/sbin/adb https://raw.githubusercontent.com/NicolasBernaerts/ubuntu-scripts
   /master/android/adb
   sudo wget -O 
   /usr/local/sbin/fastboot https://raw.githubusercontent.com/NicolasBernaerts/ubuntu-scripts
   /master/android/fastboot
   
   sudo cp adb /usr/local/sbin/
   sudo cp fastboot /usr/local/sbin/
   sudo unzip platform-tools_r29.0.6-linux.zip /usr/local/sbin/
   sudo chmod +x /usr/local/sbin/platform-tools/adb /usr/local/sbin/adb 
   sudo chmod +x /usr/local/sbin/platform-tools/fastboot /usr/local/sbin/fastboot
   
   sudo vim /etc/profile
   export PATH=/usr/local/sbin:$PATH
   source /etc/profile
   
   2) win10ç³»ç»Ÿ
   adb tcpip 5555
   adb connect 192.168.0.103 (æœåŠ¡å™¨ipåœ°å€)
   å¤œç¥æ¨¡æ‹Ÿå™¨-æ‰‹æœºä¸ç½‘ç»œ-å¼€å¯ç½‘ç»œæ¡¥æ¥è¿æ¥
   
   å®‰è£…ã€å¸è½½apk:
   adb install apkå®‰è£…åŒ…è·¯å¾„
   adb shell pm list packages
   adb uninstall com.tal.kaoyan
   ```

7. u2è‡ªåŠ¨åŒ–æŠ“å–å¼€å‘ç¯å¢ƒçŸ¥è¯†ç‚¹å›é¡¾

   ```markdown
   VMware
   SecureCrt
   
   virtualenv
   pycharm
   
   adb(win: å¤œç¥æ¨¡æ‹Ÿå™¨ / ubuntu: adbã€fastfootã€platform-tools-latest-linux.zip)
   å®‰è£…apk,å¸è½½adb
   ```

8. å¦‚ä½•è¿æ¥çœŸå®ç§»åŠ¨è®¾å¤‡å¹¶å®‰è£…apk

   ```markdown
   # win10ç³»ç»Ÿ + å‘æ—¥è‘µè¿œç¨‹å·¥å…·
   1) adb(å¤œç¥æ¨¡æ‹Ÿå™¨å·²ç»å®‰è£…å¹¶é…ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡)å¯ä»¥æ­£å¸¸ä½¿ç”¨
   2) å°†androidæ‰‹æœºé€šè¿‡usbçº¿ä¸win10è¿æ¥(ç®¡ç†-è®¾å¤‡ç®¡ç†å™¨(æŸ¥çœ‹é©±åŠ¨æ˜¯å¦å®‰è£…,æœªå®‰è£…ä¼šæ˜¾ç¤º!))
   3) æ‰‹æœºå¼€å¯å¼€å‘è€…é€‰é¡¹å’ŒUSBè°ƒè¯•(USBè¿æ¥è¿‡å¯ä»¥å…ˆæ“ä½œ"æ’¤é”€USBè°ƒè¯•æˆæƒ",å†å¼€å¯å¼€å‘è€…é€‰é¡¹å’ŒUSBè°ƒè¯•)
   4) æŸ¥çœ‹è®¾å¤‡åˆ—è¡¨: adb devices
   
   # å®‰è£…apk,å¸è½½adb
   adb install apkå®‰è£…åŒ…è·¯å¾„ -s (æŒ‡å®šè®¾å¤‡)
   adb install  apkå®‰è£…åŒ…è·¯å¾„
   adb shell pm list packages
   adb uninstall com.tal.kaoyan(apkçš„åŒ…å)
   ```

9. å®‰è£…u2å’Œu2é¡¹ç›®åˆå§‹åŒ–

   ```markdown
   pip install uiautomator2 -i https://pypi.douban.com/simple
   ç¬¬ä¸€æ¬¡ä¼šåœ¨å¤œç¥æ¨¡æ‹Ÿå™¨å®‰è£…atx-agent: python -m uiautomator2 init   
   
   uiautomator-server: è°·æ­ŒåŸç”Ÿçš„uiautomator
   atx-agent: uiautomatorçš„å®ˆæŠ¤è¿›ç¨‹. atx-agentå¢å¼ºè¿œç¨‹æ§åˆ¶çš„åŠŸèƒ½,ä¾èµ–minicapå’Œminitouchè¿™ä¸¤ä¸ªå·¥å…·
   
   å®‰è£…æ–‡ä»¶æ‰€åœ¨ç›®å½•: .uiautomator2/cache/
   ```

10. u2è¿æ¥ç§»åŠ¨è®¾å¤‡çš„ä¸‰ç§æ–¹å¼

   ```markdown
   # æ‰“å¼€å¤œç¥æ¨¡æ‹Ÿå™¨
   # u2æ§åˆ¶ç§»åŠ¨è®¾å¤‡
   https://github.com/openatx/uiautomator2/issues/365
   é€šè¿‡wifi:     é€šè¿‡usbè¿æ¥æ‰‹æœº æ‰‹æœºipåœ°å€
   é€šè¿‡usb:      æ‰‹æœºåºåˆ—å·
   é€šè¿‡adb wifi: 192.168.0.103:5555
   adp tcpip 5555  
   adb connect 192.168.0.103
   
   u2_test.py
   
   è·å–apkåŒ…å: aapt dump badging /c/Users/lenovo/Desktop/douyin10.0.apk
   ```

##### u2å®šä½å…ƒç´ æ–¹æ³•
1. u2è‡ªåŠ¨åŒ–å·¥å…·åŸºæœ¬æ“ä½œ-æ“ä½œè®¾å¤‡

   ```markdown
   # æ“ä½œatx-agent
   adb devices
   adb shell
   chmod 755 /data/local/tmp/atx-agent
   data/local/tmp/atx-agent version 
   /data/local/tmp/atx-agent server -d 
   /data/local/tmp/atx-agent server -d --stop
   
   # æ“ä½œè®¾å¤‡
   u2_device.py
   ```

2. u2è‡ªåŠ¨åŒ–å·¥å…·åŸºæœ¬æ“ä½œ-æ“ä½œapp

   ```markdown
   u2_app.py
   ```

3. Activityå’Œæ§ä»¶

   ```markdown
   # Activity
   Activityæ˜¯ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºäº¤äº’çš„çª—å£,ä¸€ä¸ªActivityç›¸å½“äºæˆ‘ä»¬å®é™…ä¸­çš„ä¸€ä¸ªç½‘é¡µ
   
   # æ§ä»¶
   TextView æ˜¾ç¤ºæ–‡å­—
   EditText è¾“å…¥æ¡†,å¯ç¼–è¾‘
   ImageView æ˜¾ç¤ºå›¾ç‰‡
   Button æŒ‰é’®
   CheckBox å¤é€‰æ¡†
   RadioButton å•é€‰æŒ‰é’®
   https://blog.csdn.net/weixin_38423829/article/details/80566203
   ```

4. weditorå®‰è£…å¯åŠ¨å’Œä»‹ç»

   ```markdown
   # weditorå®‰è£…
   pip3 install weditor -i https://pypi.tuna.tsinghua.edu.cn/simple/
   
   # weditorå¯åŠ¨
   adb devices
   weditor
   http://localhost:17310/
   
   # weditoråŸºæœ¬ä½¿ç”¨
   ç§»åŠ¨è®¾å¤‡ç•Œé¢é€‰å–åŒºåŸŸ
   æ§ä»¶å±æ€§åŒºåŸŸ
   ä»£ç å±•ç¤ºåŒºåŸŸ
   å±‚çº§å…³ç³»åŠè¿è¡Œç»“æœå±•ç¤ºåŒºåŸŸ
   
   Android 127.0.0.1:62001  Connect  Dump Hierararchy
   ```

5. Androidçš„å¸ƒå±€ä¸æ§ä»¶å®šä½ 

   ```markdown
   # å®šä½å·¥å…·
   UiSelector: ä»£è¡¨ä¸€ç§æœç´¢æ ‡å‡†,å¯ä»¥åœ¨å½“å‰å±•ç¤ºç•Œé¢ä¸ŠæŸ¥è¯¢å’Œè·å–ç‰¹å®šå…ƒç´ çš„å¥æŸ„
   Xpath
  
   # Androidçš„å¸ƒå±€ä¸æ§ä»¶
   åç§°       å¸ƒå±€æ–¹å¼
   çº¿æ€§å¸ƒå±€    linearLayout
   ç›¸å¯¹å¸ƒå±€    RelativelLayout
   å¸§å¸ƒå±€      FrameLayout
   è¡¨æ ¼å¸ƒå±€    TableLayout
   ç»å¯¹å¸ƒå±€    AbsoluteLayout
   
   çº¿æ€§å¸ƒå±€: æŒ‰ç…§æ°´å¹³æˆ–å‚ç›´çš„é¡ºåºå°†å­å…ƒç´ (å¯ä»¥æ˜¯æ§ä»¶æˆ–å¸ƒå±€)ä¾æ¬¡æŒ‰ç…§é¡ºåºæ’åˆ—,æ¯ä¸€ä¸ªå…ƒç´ éƒ½ä½äºå‰é¢ä¸€ä¸ªå…ƒç´ ä¹‹å
   çº¿æ€§å¸ƒå±€åˆ†ä¸ºä¸¤ç§:æ°´å¹³æ–¹å‘å’Œå‚ç›´æ–¹å‘çš„å¸ƒå±€
   ç›¸å¯¹å¸ƒå±€: æŒ‰ç…§å­å…ƒç´ ä¹‹é—´çš„ä½ç½®å…³ç³»å®Œæˆå¸ƒå±€
   å¸§å¸ƒå±€: å¥½æ¯”ä¸€å—åœ¨å±å¹•ä¸Šæå‰é¢„å®šå¥½çš„ç©ºç™½åŒºåŸŸ,å¯ä»¥å°†ä¸€äº›å…ƒç´ å¡«å……åœ¨é‡Œé¢
   è¡¨æ ¼å¸ƒå±€: ç»§æ‰¿äº†çº¿æ€§å¸ƒå±€
   ç»å¯¹å¸ƒå±€: é€šè¿‡åæ ‡(x,y)æ¥æ§åˆ¶ç»„ä»¶å¦‚ä½•åœ¨å±å¹•ä¸­æ˜¾ç¤º,åŒ…æ‹¬å®šä¹‰ç»„ä»¶çš„åæ ‡(x,y)å’Œå®šä¹‰ç»„ä»¶çš„å®½é«˜(widthå’Œheight)
   
   # æ§ä»¶
   TextView æ˜¾ç¤ºæ–‡å­—
   EditText è¾“å…¥æ¡†,å¯ç¼–è¾‘
   ImageView æ˜¾ç¤ºå›¾ç‰‡
   Button æŒ‰é’®
   CheckBox å¤é€‰æ¡†
   RadioButton å•é€‰æŒ‰é’®
   
   # æ§ä»¶å±æ€§
   index        int       ç´¢å¼•
   instance     int       å®ä¾‹
   class        String    ç±»å
   package      String    åŒ…å
   Content desc String    æè¿°
   checkable    boolean   æ§ä»¶å‹¾é€‰çŠ¶æ€
   clecked      boolean
   clickable    boolean   æ§ä»¶å¯ç‚¹å‡»
   enabled      boolean
   focusable    boolean   ç„¦ç‚¹
   focused      boolean
   Scrollable   boolean   æ»šåŠ¨æ¡
   Long-clickable  boolean  é•¿æŒ‰
   password     boolean    å¯†ç 
   selected     boolean    é€‰æ‹©çŠ¶æ€
   bounds       Rect       èŒƒå›´
   ```

6. UiSelectorå®šä½æ§ä»¶

   ```markdown
   u2_selector.py
   
   # textæ–‡æœ¬é€‰å–æ–¹å¼
   text å…¨æ–‡æœ¬åŒ¹é…
   textContains æ–‡æœ¬åŒ…å«
   textMatches æ­£åˆ™è¡¨è¾¾å¼
   textStartsWith èµ·å§‹æ–‡æœ¬
   
   # descriptionæ–‡æœ¬é€‰å–æ–¹å¼
   description å…¨æ–‡æœ¬åŒ¹é…
   descriptionContains æ–‡æœ¬åŒ…å«
   descriptionMatches æ­£åˆ™è¡¨è¾¾å¼
   descriptionStartsWith èµ·å§‹æ–‡æœ¬
   
   # classNameé€‰å–æ–¹å¼
   className classNameåŒ¹é…
   classNameMatches classNameæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…
   
   # resourceIdèµ„æºIDé€‰å–æ–¹å¼
   resourceId å…¨èµ„æºIDåŒ¹é…
   resourceIdMatches æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…
   
   # æ··åˆå®šä½æ–¹å¼
   çˆ¶å­èŠ‚ç‚¹ã€å…„å¼ŸèŠ‚ç‚¹
   
   # åæ ‡å®šä½æ–¹å¼ 
   # æ§ä»¶æ“ä½œå’Œæ“ä½œè¶…æ—¶
   ```
   
7. é€šè¿‡U2å®ç°ç§»åŠ¨è®¾å¤‡ä¹å®«æ ¼è§£é”

   ```markdown
   hack_lock.py
   ```

8. xpathå®šä½æ–¹å¼

   ```markdown
   # xpath
   XML Path Language,å³XMLè·¯å¾„è¯­è¨€,å®ƒæ˜¯ä¸€é—¨åœ¨XMLæ–‡æ¡£ä¸­æŸ¥æ‰¾ä¿¡æ¯çš„è¯­è¨€,åŒæ ·é€‚ç”¨äºHTMLæ–‡æ¡£çš„æœç´¢
   
   u2_xpath.py
   xpath_example.html
   
   # xpathå¸¸ç”¨è§„åˆ™
   /ä»å½“å‰èŠ‚ç‚¹é€‰å–ç›´æ¥å­èŠ‚ç‚¹
   //ä»å½“å‰èŠ‚ç‚¹é€‰å–å­å­™èŠ‚ç‚¹
   .é€‰å–å½“å‰èŠ‚ç‚¹
   ..é€‰å–å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹
   @é€‰å–å±æ€§
   
   # xpath helperçš„chromeæ’ä»¶
   //li[@class='item-0']
   //*
   //li
   //li[@class='item-1']
   //li/a
   //ul
   //ul//a 
   //ul/a
   //a[@href="https://coding.imooc.com/class/283.html"]/../@class
   //a[@href="https://coding.imooc.com/class/283.html"]/parent::*/@class
   //li[@class='other_item']/a/text()
   //li[@class='item-3']//text()
   //li[@class='item-3']/a/@href
   
   # appæ§ä»¶å®šä½æ–¹æ³•
   æ–‡å­—å±æ€§å®šä½
   èµ„æºIDå±æ€§å®šä½
   classNameå®šä½
   é“¾å¼è°ƒç”¨å…³ç³»å®šä½
   åæ ‡å®šä½
   xpathå®šä½
   ```

9. ç™»å½•è€ƒç ”å¸®appå¹¶æ»‘åŠ¨è€ƒç ”èµ„è®¯

   ```markdown
   1) è¿æ¥è®¾å¤‡
   2) å¯åŠ¨app
   3) åˆ¤æ–­æ˜¯å¦æ‰“å¼€äº†ç™»å½•é¡µé¢
   4) è¾“å…¥ç”¨æˆ·åå¯†ç ,ç‚¹å‡»ç™»å½•
   5) åˆ¤æ–­æ˜¯å¦è¿›å…¥appé¦–é¡µ,ä¹Ÿå°±æ˜¯å½“å‰æ´é¢æ˜¯å¦æœ‰ç ”è®¯æ§ä»¶,ç‚¹å‡»ç ”è®¯æŒ‰é’®
   6) æ»‘åŠ¨ç ”è®¯é¡µé¢,ä¸€èˆ¬åœ¨å±å¹•ä¸­é—´ä½ç½®æ»‘åŠ¨,å³æˆ‘ä»¬éœ€è¦è·å–åˆ°å±å¹•çš„å°ºå¯¸å¤§å°
   7) ä¸€ç›´å‘ä¸‹æ»‘åŠ¨,å½“å±å¹•å‡ºç°å†…å®¹å·²ç»å…¨éƒ¨åŠ è½½å®Œæ¯•è¿™ä¸ªæç¤º,åœæ­¢æ»‘åŠ¨
   8) å…³é—­appå¹¶æ¸…ç†ç¼“å­˜
   
   u2_kaoyanbang.py
   ```

##### çˆ¬è™«å¿…å¤‡åˆ©å™¨-æŠ“åŒ…å·¥å…·çš„ä½¿ç”¨
1. fiddleræŠ“åŒ…å·¥å…·è¯¦è§£-1

   ```markdown
   # å¸¸è§appæŠ“åŒ…è½¯ä»¶å¯¹æ¯”
   æŠ“åŒ…è½¯ä»¶åç§°   æ”¯æŒçš„æ“ä½œç³»ç»Ÿ  é€‚ç”¨å¹³å°       è°ƒè¯•éš¾æ˜“ç¨‹åº¦   è½¯ä»¶åŠŸèƒ½ç¨‹åº¦
   fiddler      win/linux    ç½‘é¡µç«¯ã€appç«¯     ä¸€èˆ¬           å¤š
   mitmproxy    win/mac/linux ç½‘é¡µç«¯ã€appç«¯    ä¸€èˆ¬           å¤š
   packetCapture å®‰å“          appç«¯          ç®€å•           å°‘
   
   # FiddleræŠ“åŒ…è½¯ä»¶ä»‹ç»
   Fiddleræ˜¯ä¸€ä¸ªwebè°ƒè¯•ä»£ç†å¹³å°,å¯ä»¥ç›‘æ§å’Œä¿®æ”¹webæ•°æ®æµ
   åŠŸèƒ½å¼ºå¤§
   1) æ”¯æŒIE,Chrome,Safari,Firefoxå’ŒOperaç­‰æµè§ˆå™¨
   2) å¯ä»¥åœ¨iphoneã€ipadç­‰ç§»åŠ¨è®¾å¤‡ä¸Šè¿›è¡Œè¿æ¥
   ä¼˜ç‚¹
   1) å¯ä»¥æŸ¥çœ‹æ‰€æœ‰æµè§ˆå™¨ã€å®¢æˆ·ç«¯åº”ç”¨æˆ–æœåŠ¡ä¹‹é—´çš„webæ•°æ®æµ
   2) æ‰‹åŠ¨æˆ–è‡ªåŠ¨ä¿®æ”¹ä»»æ„çš„è¯·æ±‚å’Œå“åº”
   3) å¯ä»¥è§£å¯†HTTPSæ•°æ®æµä»¥ä¾¿æŸ¥çœ‹å’Œä¿®æ”¹
   ç¼ºç‚¹
   1) fiddleråªæ”¯æŒhttpã€httpsã€ftpã€websocketæ•°æ®æµç­‰ç›¸å…³åè®®
   2) æ— æ³•ç›‘æµ‹æˆ–ä¿®æ”¹å…¶ä»–æ•°æ®,å¦‚SMTPã€POP3ç­‰
   3) fiddleræ— æ³•å¤„ç†è¯·æ±‚å’Œå“åº”è¶…è¿‡2GBçš„æ•°æ®
   
   Client <=request/response=>Fiddler(Proxy)<=request/response=> Server
   
   File:
   Capture Traffic
   New Viewer
   Load Archive
   Recent Archives
   Save
   Import Sessions
   Export Session
   Exit
   
   Edit:
   Copy
   Remove
   Select All
   Paste as Sessions
   Mark
   Unlock for Editing
   Find Sessions
   
   Tools:
   Options(
      HTTPS: Capture HTTPS CONNECTs
             Decrypt HTTPS traffic
             from remote clients only
             Actions å®‰è£…è¯ä¹¦)
      Connections: Fiddler listens on port 8888
   WinINET Options
   Clear WinINET Caches
   Clear WinINET Cookies
   TextWizard
   HOSTS
   
   Proxy SwitchyOmega
   æ–°å»ºæƒ…æ™¯æ¨¡å¼: fiddler-ä»£ç†åè®®HTTP-ä»£ç†æœåŠ¡å™¨192.168.0.108-ä»£ç†ç«¯å£8888-åº”ç”¨é€‰é¡¹
   åˆ‡æ¢ä¹‹fidleræƒ…æ™¯æ¨¡å¼
   æ¸…ç†fiddleræŠ“åŒ…å·¥å…·session,é€šè¿‡ç«ç‹æµè§ˆå™¨æ‰“å¼€ç½‘å€å³å¯
   
   Rules:
   Hide Image Requests
   Hide CONNECTs
   Automatic Breakpoints
   Require Proxy Authentication
   Apply GZIP Encoding
   Remove All Encodings
   Hide 304s
   Automaticically Authenticate
   User-Agents
   Performance
   
   å·¥å…·æ :
   WinConfig
   ğŸ«§ æ·»åŠ sessionæ³¨é‡Š
   Replay é‡æ”¾
   âœ–ï¸ åˆ é™¤
   Go
   Stream
   Decode
   Keep: All sessions
   Any Process
   Find
   Sava
   ğŸ“· å¿«ç…§
   ğŸ•™ å®šæ—¶å™¨
   Browse
   Clear Cache
   TextWizard
   
   Fiddler Orchestra Beta
   FiddlerScript
   Log
   Filters
   Timeline
   Statistics
   Inspectors
   AutoResponder
   Composer
   Get Started
   ```
   
2. fiddleræŠ“åŒ…å·¥å…·è¯¦è§£-2

   ```markdown
   # æ ‡è¯†ç¬¦
   # HTTPçŠ¶æ€ç 
   # è¯·æ±‚å¤´å’Œå“åº”å¤´
   Inspectors-Raw
   
   # è®¾ç½®æ–­ç‚¹çš„ä¸¤ç§æ–¹å¼
   åŸºäºå›¾å½¢ç•Œé¢
   åŸºäºå‘½ä»¤è¡Œ
   
   # åŸºäºå›¾å½¢ç•Œé¢
   Rules-Automatic Breakpoints
   
   # åŸºäºå‘½ä»¤è¡Œ
   bpu å–æ¶ˆæ‰€æœ‰è¯·æ±‚åŒ…çš„æ‹¦æˆª
   bpafter https://www.baidu.com å“åº”åæ–­ç‚¹è®¾ç½®
   bpbefore https://www.baidu.com è¯·æ±‚å‰æ–­ç‚¹è®¾ç½®
   bda å–æ¶ˆæ‰€æœ‰å“åº”åŒ…çš„æ‹¦æˆª
   
   # ç½‘é¡µé‡å®šå‘
   é€‰ä¸­ä¸€ä¸ªè¯·æ±‚,ç‚¹å‡»AutoResponder,å°†é€‰ä¸­çš„è¯·æ±‚æ‹–è¿‡æ¥
   Rule Editor - Find a file - save
   ```
   ![](/Users/bruce/Documents/ç¬”è®°æˆªå›¾/æ ‡è¯†ç¬¦.png)
   ![](/Users/bruce/Documents/ç¬”è®°æˆªå›¾/HTTPçŠ¶æ€ç .png)
   ![](/Users/bruce/Documents/ç¬”è®°æˆªå›¾/HTTPçŠ¶æ€ç 2.png)

3. fiddleræŠ“åŒ…å·¥å…·è¯¦è§£-3

   ```markdown
   win10: 
   ipconfigæŸ¥çœ‹ipåœ°å€
   
   mac:
   å¤œç¥æ¨¡æ‹Ÿå™¨
   ç½‘ç»œæ¡¥æ¥æ¨¡å¼: å¼€å¯  
   å®‰è£…é©±åŠ¨ 
   dhcp
   ä¿å­˜é‡å¯å¤œç¥æ¨¡æ‹Ÿå™¨
   é€‰æ‹©WiredSSID,é•¿æŒ‰é¼ æ ‡å·¦é”®,ä¿®æ”¹ç½‘ç»œ,æ˜¾ç¤ºé«˜çº§é€‰é¡¹
   ä»£ç†: æ‰‹åŠ¨
   ä»£ç†æœåŠ¡å™¨ä¸»æœºå: 192.168.0.108
   ä»£ç†æœåŠ¡å™¨ç«¯å£: 8888
   æ‰“å¼€è‡ªå¸¦æµè§ˆå™¨: https://www.baidu.com
   192.168.0.108:8888
   FiddlerRoot certificateå®‰è£… è®¾ç½®å¯†ç 
   
   win10:
   Fiddler
   Tools - Options - HTTPS
      from browser only/from remote clients only 
      Allow remote computers to connect
   æ¸…é™¤æ•°æ®åŒ…
   ç‚¹å‡»Stream Decode  Inspectors Raw
   ```
   
4. mitmproxyæŠ“åŒ…å·¥å…·è¯¦è§£

   ```markdown
   # mitmproxyä»‹ç»
   mitmproxyå°±æ˜¯ç”¨äºMITMçš„proxy
   MITMå³ä¸­é—´äººæ”»å‡»(Man-in-the-middle attack)
   
   client -1.Request-> mitmproxy -2.Forwarded Request-> server
   
   1) å’Œæ­£å¸¸çš„ä»£ç†ä¸€æ ·è½¬å‘è¯·æ±‚,ä¿éšœæœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯çš„é€šä¿¡
   2) æ‹¦æˆªè¯·æ±‚,ä¿®æ”¹è¯·æ±‚,æ‹¦æˆªè¿”å›,ä¿®æ”¹è¿”å›
   3) å¯ä»¥è½½å…¥è‡ªå®šä¹‰pythonè„šæœ¬
   
   # mitmproxyå®‰è£…
   pip3 install mitmproxy
   
   ç«ç‹æµè§ˆå™¨-SwitchyOmega-æ–°å»ºæƒ…æ™¯æ¨¡å¼mitmproxy-HTTP 0.0.0.0 8080-åº”ç”¨é€‰é¡¹
   
   å®‰è£…è¯ä¹¦: http://mitm.it/
   åŒå‡»mitmproxy-ca-cert.pemå³å¯å¼¹å‡ºé’¥åŒ™ä¸²ç®¡ç†é¡µé¢,ç„¶åæ‰¾åˆ°mitmproxyè¯ä¹¦,é€‰æ‹©å§‹ç»ˆä¿¡ä»»å³å¯
   ç«ç‹æµè§ˆå™¨ç½‘ç»œè®¾ç½®: æ‰‹åŠ¨é…ç½®ä»£ç†HTTPä»£ç†0.0.0.0 8080 ä¹Ÿå°†æ­¤ç”¨äºHTTPS
   ç«ç‹æµè§ˆå™¨éšç§ä¸å®‰å…¨:æŸ¥çœ‹è¯ä¹¦-è®¤è¯é¢å‘æœºæ„-å¯¼å…¥è¯ä¹¦-ä¿¡ä»»
   æ­¤æ—¶å¯ä»¥è®¿é—®httpsçš„ç½‘ç«™,æˆªå–æ•°æ®
   
   # mitmproxyçš„ä¸‰ä¸ªç»„ä»¶
   mitmproxy
   mitmdump
   mitmweb
   
   # mitmproxyç§»åŠ¨è®¾å¤‡å®‰è£…è¯ä¹¦ã€ç§»åŠ¨è®¾å¤‡æŠ“åŒ…
   mitmproxy -p 8080
   
   å¤œç¥æ¨¡æ‹Ÿå™¨
   ç½‘ç»œæ¡¥æ¥æ¨¡å¼: å¼€å¯ 
   å®‰è£…é©±åŠ¨
   dhcp
   ä¿å­˜é‡å¯å¤œç¥æ¨¡æ‹Ÿå™¨
   é€‰æ‹©WiredSSID,é•¿æŒ‰é¼ æ ‡å·¦é”®,ä¿®æ”¹ç½‘ç»œ,æ˜¾ç¤ºé«˜çº§é€‰é¡¹
   ä»£ç†: æ‰‹åŠ¨
   ä»£ç†æœåŠ¡å™¨ä¸»æœºå: 192.168.0.109
   ä»£ç†æœåŠ¡å™¨ç«¯å£: 8080
   æ‰“å¼€è‡ªå¸¦æµè§ˆå™¨ https://www.baidu.com
   192.168.0.109:8080
   mitm.it: ä¸‹è½½å®‰è£…å¹¶ä¿¡ä»»androidè¯ä¹¦ å®‰å…¨-å—ä¿¡ä»»å‡­æ®
   z æ¸…é™¤æ•°æ®åŒ…
   
   # mitmproxyæ•°æ®åŒ…è¿‡æ»¤å’Œæ–­ç‚¹è°ƒè¯•
   f
   set view_filter '!(~c 200)'
   f
   set view_filter ''
   f
   set view_filter '~d baidu.com'
   f
   set view_filter '~d qq.com'
   f
   set view_filter '~m post & ~u baidu'
   f
   set view_filter ''
   i
   : set intercept '~d baidu.com & ~m get'
   ç§»åŠ¨è®¾å¤‡è®¿é—®www.baidu.com
   é€‰ä¸­æ•°æ®åŒ…,ç‚¹å‡»
   e request-headers
   d
   q
   e url
   : flow.set @focus url https://xw.qq.com
   q
   a
   ç§»åŠ¨è®¾å¤‡è®¿é—®www.baidu.com å›è½¦
   response e
   response-body aaaa
   :wq
   q
   a
   
   # mitmdump-dumpçš„ä½¿ç”¨
   mitmdump_test.py
   mitmdump -p 8080 -s mitmdump_test.py
   http://httpbin.org/get
   ```
   
5. appæ— æ³•æŠ“åŒ…æ¢ç§˜

   ```markdown
   # appé™å®šç³»ç»Ÿä»£ç†æ¥å£
   1) é€šè¿‡xposeæ¡†æ¶,ç¼–å†™xposeç ´è§£ä»£ç ,ç»•è¿‡æˆ–æ›´æ”¹è·å–ç³»ç»Ÿä»£ç†åˆ¤å®šçš„è¿”å›å€¼
   ä¸‹è½½xposed apkå®‰è£…åŒ…: 
   https://repo.xposed.info/module/de.robv.android.xposed.installer
   é€šè¿‡åˆ·æœºåˆ·å…¥xposedæ¡†æ¶
   2) proxydroid ç ´è§£/root  Proxy Switch: å¼€å¯ Host Port: fiddler/mitmproxy
   3) Packet Capture
   Packet Captureæ˜¯ä¸€æ¬¾å…rootçš„app,è¿è¡Œåœ¨å®‰å“å¹³å°ä¸Š,ç”¨äºæ•è·http/httpsç½‘ç»œæµé‡å—…æ¢çš„åº”ç”¨ç¨‹åº
   ç”¨äºæ•è·æ•°æ®åŒ…,å¹¶è®°å½•å®ƒä»¬,ä½¿ç”¨ä¸­é—´äººæŠ€æœ¯å¯¹SSLè§£å¯†,æ— éœ€rootæƒé™,è¿™ä¸ªè½¯ä»¶ä½¿ç”¨androidæä¾›çš„
   VpnService api,å®ç°ä¸­é—´äººæ”»å‡»
   
   # appå¯ç”¨ssl-pinningæŠ€æœ¯é˜²æ­¢ä¸­é—´äººæ”»å‡»
   JustTrustMe
   
   # appé‡‡ç”¨åŒå‘è¯ä¹¦ç»‘å®šæŠ€æœ¯
   JustTrustMeæ¬ºéª—å®¢æˆ·ç«¯,Fiddleræ¬ºéª—æœåŠ¡ç«¯
   é€†å‘appæŸ¥çœ‹æ•°æ®æ¥å£
   ```
   ![](/Users/bruce/Documents/ç¬”è®°æˆªå›¾/appæŠ“åŒ….png)
   ![](/Users/bruce/Documents/ç¬”è®°æˆªå›¾/appæŠ“åŒ…-2.png)

##### Appåº”ç”¨æ•°æ®æŠ“å–å…¥é—¨(è±†æœç¾é£Ÿfiddlerç‰ˆ)
1. æŠ“å–å‰è®¾ç½®ã€å¯åŠ¨è±†æœç¾é£Ÿappå¹¶æŠ“åŒ…

   ```markdown
   æ‰“å¼€å¤œç¥æ¨¡æ‹Ÿå™¨  
   adb connect 127.0.0.1:62001
   adb devices
   adb install /Users/bruce/workspace/mobile-spider/apk/douguomeishi/douguomeishi.apk
   æ‰“å¼€fiddler
   Tools-Options-HTTPS
      Capture HTTPS CONNECTs
      Decrypt HTTPS traffic
      from remote clients only
   Tools-Options-Connections
      8888
      Allow remote computers to connect
   Firefoxæµè§ˆå™¨ä»£ç†è®¾ç½®
      SwitchyOmega
        æ–°å»ºæƒ…æ™¯æ¨¡å¼ fiddler: HTTP 192.168.0.108 8888 åº”ç”¨é€‰é¡¹
      è®¾ç½®-éšç§ä¸å®‰å…¨-è¯ä¹¦-è¯ä¹¦ç®¡ç†å™¨-è¯ä¹¦é¢å‘æœºæ„-å¯¼å…¥è¯ä¹¦å¹¶å®Œå…¨ä¿¡ä»»
      è®¾ç½®-ç½‘ç»œè®¾ç½®-è¿æ¥è®¾ç½®-æ‰‹åŠ¨é…ç½®ä»£ç†-192.168.0.108 8888 ä¹Ÿå°†æ­¤ä»£ç†åº”ç”¨äºHTTPS
   å¤œç¥æ¨¡æ‹Ÿå™¨ä»£ç†è®¾ç½®
      è‡ªå¸¦æµè§ˆå™¨æ‰“å¼€-www.baidu.com/192.168.0.108:8888/å®‰è£…ç›¸å…³è¯ä¹¦å¹¶ä¿¡ä»»
      è‡ªå¸¦æµè§ˆå™¨-è®¾ç½®-éšç§å’Œå®‰å…¨-æ˜¾ç¤ºå®‰å…¨è­¦å‘Šå»æ‰âœ…
      è®¾ç½®-å®‰å…¨-ç”¨æˆ·å‡­è¯/ä¿¡ä»»çš„å‡­è¯æŸ¥çœ‹å¹¶ä¿¡ä»»å‡­è¯
   æ‰“å¼€è±†æœç¾é£Ÿæµ‹è¯•fiddleræŠ“åŒ…
   ```

2. åˆ†æfiddleræŠ“å–çš„è±†æœç¾é£Ÿæ•°æ®åŒ…

   ```markdown
   api.douguo.net => Find
   /recipe/flatcatalogs
   /recipe/v2/search/0/20
   /recipe/v2/search/20/20
   ```

3. ç¼–å†™çˆ¬è™«è„šæœ¬

   ```markdown
   é¡¹ç›®éœ€æ±‚ã€è¯·æ±‚å‡½æ•°ç¼–å†™ã€è¯·æ±‚å¤´ä¼ªé€ 
   é£Ÿæé¡µé¢è§£æã€é˜Ÿåˆ—é€»è¾‘ç¼–å†™
   è·å–èœè°±åˆ—è¡¨æ•°æ®é€»è¾‘ç¼–å†™
   è¯¦æƒ…é¡µæ•°æ®æŠ“å–é€»è¾‘ç¼–å†™
   æ•°æ®å…¥åº“é€»è¾‘ç¼–å†™
   å¤šçº¿ç¨‹é€»è¾‘ç¼–å†™
   ä¼ªè£…çˆ¬è™«-ç¼–å†™ä»£ç†é€»è¾‘
   
   åˆ†æè±†æœç¾é£Ÿæ•°æ®åŒ…
   é€šè¿‡pythonå¤šçº¿ç¨‹-çº¿ç¨‹æ± æŠ“å–æ•°æ®
   é€šè¿‡ä½¿ç”¨ä»£ç†ipéšè—çˆ¬è™«
   å°†æ•°æ®ä¿å­˜åˆ°mongodbä¸­
   
   spider_douguomeishi.py
   handel_mongo.py
   handle_proxy.py
   
   pip3 install pymongo -i https://pypi.tuna.tsinghua.edu.cn/simple/
   
   https://www.mongodb.com/try/download/community
   
   /d/MongoDB/Server/6.0/data/db
   /d/MongoDB/Server/6.0/log
   /d/MongoDB/Server/6.0/mongodb.config
   
   dbpath=D:\MongoDB\Server\6.0\data\db
   logpath=D:\MongoDB\Server\6.0\log\mongod.log
   logappend=true
   journal=true
   quiet=true
   port=27017
   
   ./mongod.exe --dbpath "d:mongodbdatadb"  --logpath "d:mongodblogslog.txt"  --install -serviceName "MongoDB"
   
   localhost:27017
   
   MongoDB Compasså·¥å…·
   show dbs
   use douguo_meishi
   show collections
   db.douguo_meishi_item.find()
   ```
   
##### æŠ–éŸ³æ•°æ®æŠ“å–å®æˆ˜ (appium+uiautomatorviewer+mitmproxy)
1. çŸ­è§†é¢‘æŠ“å–å®æˆ˜ä»‹ç» & è§£æçŸ­è§†é¢‘åˆ†äº«é¡µé¢æ•°æ® & åˆ†äº«idå­˜å‚¨æ•°æ®åº“é€»è¾‘ä»£ç ç¼–å†™

   ```markdown
   æŠ–éŸ³å·ã€ç²‰ä¸æ•°ã€å…³æ³¨æ•°ã€ç‚¹èµæ•°
   
   æŠ–éŸ³åäºº: æ˜µç§°ã€æŠ–éŸ³idã€åˆ†äº«idã€ç²‰ä¸æ•°ã€å…³æ³¨æ•°ã€è·èµæ•°ã€ä¸ªæ€§ç­¾å
   ç²‰ä¸åˆ—è¡¨æ•°æ®: æ˜µç§°ã€æŠ–éŸ³idã€åˆ†äº«idã€ç²‰ä¸æ•°ã€å…³æ³¨æ•°ã€è·èµæ•°ã€ä¸ªæ€§ç­¾å
   
   https://www.douyin.com/share/user/åˆ†äº«id
   handle_share_web.py
   douyin_hot_id.txt
   handle_mongo.py
   ```
   
2. ssl piningæŠ€æœ¯åˆ†æä¸xposedæ¡†æ¶å®‰è£…

   ```markdown
   # æŠ–éŸ³æ•°æ®æŠ“å–å®æˆ˜-å¸¸è§é—®é¢˜
   é—®é¢˜å¸¸è§äºçœŸå®æ‰‹æœºä¸Š
   æ‰“å¼€æŠ“åŒ…å·¥å…·ååº”ç”¨æ— æ³•è”ç½‘
   
   # ä»€ä¹ˆæ˜¯SSL pinning
   1) æ ¹æ®æµè§ˆå™¨æˆ–æ“ä½œç³»ç»ŸAndroidè‡ªå¸¦çš„è¯ä¹¦é“¾
   2) ä½¿ç”¨è‡ªç­¾åè¯ä¹¦
   3) è‡ªç­¾åè¯ä¹¦åŠ ä¸ŠSSL Pinningç‰¹æ€§
   
   SSL Pinning,å³SSLè¯ä¹¦ç»‘å®š,æ˜¯éªŒè¯æœåŠ¡å™¨èº«ä»½çš„ä¸€ç§æ–¹å¼,æ˜¯åœ¨httpsåè®®å»ºç«‹é€šä¿¡æ—¶å¢åŠ çš„ä»£ç é€»è¾‘,
   å®ƒé€šè¿‡è‡ªå·±çš„æ–¹å¼éªŒè¯æœåŠ¡å™¨èº«ä»½ç„¶åå†³å®šé€šä¿¡æ˜¯å¦ç»§ç»­ä¸‹å».å®ƒå”¯ä¸€æŒ‡å®šæœåŠ¡å™¨çš„èº«ä»½æ‰€ä»¥å®‰å…¨æ€§è¾ƒé«˜
   
   # è§£å†³æ–¹æ¡ˆ
   å®‰è£…Xposedæ¡†æ¶+JustTruestMeç»„ä»¶
   Xposedæ˜¯ä¸€ä¸ªæ¡†æ¶,å®ƒå¯ä»¥æ”¹å˜ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„è¡Œä¸º,è€Œä¸æ¥è§¦ä»»ä½•APK.å®ƒæ”¯æŒå¾ˆå¤šæ¨¡å—,æ¯ä¸ªæ¨¡å—å¯ä»¥ç”¨æ¥å¸®åŠ©å®ç°ä¸åŒçš„åŠŸèƒ½
   JustTruestMeæ˜¯ä¸€ä¸ªç”¨æ¥ç¦ç”¨ã€ç»•è¿‡SSLè¯ä¹¦æ£€æŸ¥çš„,åŸºäºXposedæ¨¡å—.JustTruestMeæ˜¯å°†APKä¸­æ‰€æœ‰ç”¨äºæ ¡éªŒSSLè¯ä¹¦çš„APIéƒ½è¿›è¡Œå±è”½
   ä»è€Œç»•è¿‡è¯ä¹¦æ£€æŸ¥
   
   # æ³¨æ„äº‹é¡¹
   æ‰‹æœºå¿…é¡»è·å–rootæƒé™
   å®‰è£…xposedæ¡†æ¶æœ‰æ‰‹æœºå˜ç –å±é™©
   æ‰‹æœºå¯ä»¥ç›´æ¥åˆ·å¸¦æœ‰xposedæ¡†æ¶çš„ç³»ç»Ÿ
   ```

3. åˆ†ææ¥å£æ•°æ® & appiumæ¨¡æ‹Ÿæ»‘åŠ¨æ“ä½œ

   ```markdown
   decode_douyin_fans.py
   mitmdump -s decode_douyin_fans.py -p 8888
   
   è¿æ¥çœŸå®æ‰‹æœº
   uiautomatorviewer
   appium
   douyin_appium.py
   ```
   
4. å¤šè®¾å¤‡ç«¯å¹¶å‘æŠ“å–ç²‰ä¸æ•°æ®

   ```markdown
   # æŠ–éŸ³æ•°æ®æŠ“å–å®æˆ˜-å¤šä»»åŠ¡ç«¯
   è¿è¡Œå¤šå°è®¾å¤‡(æ¨¡æ‹Ÿå™¨ã€æ‰‹æœºè®¾å¤‡)
   è¿è¡Œå¤šä¸ªappiumæœåŠ¡
   ä½¿ç”¨Pythonå¤šè¿›ç¨‹/å¤šçº¿ç¨‹
   
   # æŠ–éŸ³æ•°æ®æŠ“å–å®æˆ˜-æ³¨æ„äº‹é¡¹
   1) å¤œç¥æ¨¡æ‹Ÿå™¨çš„è¿æ¥ç«¯å£
   adb connect 127.0.0.1:62001
   é€šè¿‡ä»»åŠ¡ç®¡ç†å™¨æŸ¥æ‰¾noxvmhandle frontendçš„PID,é€šè¿‡PIDåœ¨netstat -ano | findstr "PID"ä¸­æŸ¥æ‰¾ç«¯å£å ç”¨æƒ…å†µ
   ç¬¬ä¸€ä¸ªæ¨¡æ‹Ÿå™¨ç«¯å£æ˜¯62001,ç¬¬äºŒä¸ªæ¨¡æ‹Ÿå™¨ç«¯å£æ˜¯62025,ç¬¬ä¸‰ä¸ªæ˜¯62025+1
   2) appiumå®¢æˆ·ç«¯è®¾ç½®udid
   3) appiumæœåŠ¡ç«¯è®¾ç½®bootstrapPort  Advanced Presets
   
   è¿æ¥çœŸå®æ‰‹æœº
   mitmdump -s decode_douyin_fans.py -p 8888
   uiautomatorviewer appium
   handle_appium_douyin.py
   
   æŒ‡å®šipä»£ç†: mitmdump --mode upstream:http://http-cla.abuyun.com:9030 --upstream-auth é€šè¡Œè¯ä¹¦:é€šè¡Œå¯†é’¥ -s decode_douyin_fans.py -p 8888
   ```

5. è§†é¢‘æŠ“å–ã€signarureåŠ å¯†å­—æ®µç ´è§£

   ```markdown
   test.html
   html_head.txt
   html_foot.txt
   handle_douyin_movie.py
   ```

6. æ€»ç»“

   ```markdown
   # æŠ–éŸ³æ•°æ®æŠ“å–å®æˆ˜-ä¸‰å¤§å—
   ä¸ªäººä¸»é¡µæ•°æ®ã€ç²‰ä¸æ•°æ®ã€è§†é¢‘æ•°æ®
   
   # æŠ–éŸ³æ•°æ®æŠ“å–å®æˆ˜-ä¸ªäººä¸»é¡µæ•°æ®
   ä¸ªäººæ•°æ®ç•Œé¢-TTFå­—ä½“æ··æ·†
   
   # æŠ–éŸ³æ•°æ®æŠ“å–å®æˆ˜-ç²‰ä¸æ•°æ®
   appiumæ¨¡æ‹Ÿæ»‘åŠ¨+mitmdumpè§£ææ•°æ®
   
   # æŠ–éŸ³æ•°æ®æŠ“å–å®æˆ˜-è§†é¢‘æ•°æ®
   ç ´è§£jsè·å–signature
   
   # æŠ–éŸ³æ•°æ®æŠ“å–å®æˆ˜-æ³¨æ„äº‹é¡¹
   1) TTFå­—ä½“æ•°æ®å¯¹åº”-å¦‚æœæŠ–éŸ³å¼•å…¥TTFå­—ä½“åº“å‘ç”Ÿæ”¹å˜,çˆ¬è™«éœ€è¦åšç›¸åº”æ›´æ”¹
   2) appiumæ¨¡æ‹Ÿæ»‘åŠ¨æŠ–éŸ³ç²‰ä¸æ•°æ®,ä¸€èˆ¬ä»…èƒ½è·å–5000æ¡ç²‰ä¸æ•°æ®
   3) ç§»åŠ¨è®¾å¤‡è®¾ç½®ä»£ç†è¿›è¡ŒæŠ“åŒ…å,å¦‚é‡åˆ°æ— æ³•è”ç½‘æˆ–æ— æ³•è§£æhttpsæ•°æ®æ—¶,éœ€è¦å®‰è£…xposedæ¡†æ¶+justtrustmeç»„ä»¶è¿›è¡Œå±è”½è¯ä¹¦å¼ºæ ¡éªŒ
   4) åœ¨è®¾ç½®å¤šè®¾å¤‡ã€å¤šè¿›ç¨‹æ•°æ®æŠ“å–æ—¶,éœ€è¦è®¾ç½®appiumæœåŠ¡ç«¯çš„bootstrapç«¯å£ä»¥åŠå®¢æˆ·ç«¯çš„udidå­—æ®µ
   5) è§†é¢‘æ•°æ®æŠ“å–,éœ€è¦ç ´è§£signatureå­—æ®µ,ä½¿ç”¨æ‹¼æ¥htmlæ–‡ä»¶,è§£æjs https://www.douyin.com/share/user/åˆ†äº«id
   6) æ•°æ®æŠ“å–æ—¶éœ€è¦åŠ ä¸Šä»£ç†,ä¼ªè£…çˆ¬è™«
   7) æ¡ä»¶å…è®¸æœ€å¥½ä½¿ç”¨çœŸå®ç§»åŠ¨è®¾å¤‡
   ```

##### æ‰“é€ å¤šä»»åŠ¡ç«¯appåº”ç”¨æ•°æ®æŠ“å–ç³»ç»Ÿ(2019ç‰ˆ)
1. æ‰“é€ å¤šä»»åŠ¡ç«¯appåº”ç”¨æ•°æ®æŠ“å–ç³»ç»Ÿ-æ¶æ„å›¾

   ```markdown
   mongodb =pymongodb=> appium-python-client =httpé€šè®¯=> docker appium <-httpé€šè®¯-> å¿«æ‰‹
                                                        docker appium <-httpé€šè®¯-> ä»Šæ—¥å¤´æ¡
   ```
   
2. Dockerç³»ç»Ÿç®¡ç†

   ```markdown
   # DockeråŸºæœ¬æ¦‚å¿µ
   ä»€ä¹ˆæ˜¯docker hub
   Docker Hubæ˜¯ä¸€ä¸ªä»“åº“:https://hub.docker.com/
   ä»“åº“æ˜¯é›†ä¸­å­˜æ”¾é•œåƒæ–‡ä»¶çš„åœºæ‰€
   ä»“åº“åˆ†ä¸ºå…¬å¼€ä»“åº“Publicå’Œç§æœ‰ä»“åº“Privateä¸¤ç§å½¢å¼
   
   docker login
   docker search centos
   docker images
   docker pull centos
   
   ä»€ä¹ˆæ˜¯é•œåƒ 
   linuxé•œåƒ dockeré•œåƒ
   Dockeré•œåƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ç³»ç»Ÿ,é™¤äº†æä¾›å®¹å™¨è¿è¡Œæ—¶æ‰€éœ€çš„ç¨‹åºã€åº“ã€èµ„æºã€é…ç½®æ–‡ä»¶å¤–,è¿˜åŒ…å«äº†ä¸€äº›ä¸ºè¿è¡Œæ—¶å‡†å¤‡çš„ä¸€äº›é…ç½®å‚æ•°(å¦‚åŒ¿åå·ã€
   ç¯å¢ƒå˜é‡ã€ç”¨æˆ·ç­‰).é•œåƒä¸åŒ…å«ä»»ä½•åŠ¨æ€æ•°æ®,å…¶å†…å®¹åœ¨æ„å»ºä¹‹åä¹Ÿä¸ä¼šè¢«æ”¹å˜
   
   ä»€ä¹ˆæ˜¯å®¹å™¨
   å®¹å™¨æ˜¯ä¸€ç§è½»é‡çº§,å¯ç§»æ¤,è‡ªåŒ…å«çš„è½¯ä»¶æ‰“åŒ…æŠ€æœ¯,æ˜¯ä¸€ç§åº”ç”¨ç¨‹åº,å¯ä»¥åœ¨å‡ ä¹ä»»ä½•åœ°æ–¹ä»¥ç›¸åŒçš„æ–¹å¼è¿è¡Œ
   å¼€å‘äººå‘˜åœ¨è‡ªå·±ç¬”è®°æœ¬ä¸Šåˆ›å»ºå¹¶æµ‹è¯•å¥½çš„å®¹å™¨,æ— éœ€ä»»ä½•ä¿®æ”¹å°±èƒ½åœ¨ç”Ÿäº§ç³»ç»Ÿçš„è™šæ‹Ÿæœº,ç‰©ç†æœåŠ¡å™¨æˆ–å…¬æœ‰äº‘ä¸»æœºä¸Šè¿è¡Œ
   ä¸ºä»€ä¹ˆéœ€è¦å®¹å™¨ä»¥åŠä¸ºä»€ä¹ˆè¢«ç§°ä¸ºå®¹å™¨
   
   å®¹å™¨çš„ä¼˜åŠ¿,å¯¹äºå¼€å‘äººå‘˜æ¥è¯´,åˆ›å»ºä¸€æ¬¡,å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œ,å¯¹äºè¿ç»´äººå‘˜æ¥è¯´,é…ç½®ä¸€æ¬¡,å¯ä»¥è¿è¡Œæ‰€æœ‰åº”ç”¨
   dockerçš„æ ¸å¿ƒç»„ä»¶åŒ…æ‹¬: dockerå®¢æˆ·ç«¯,dockeræœåŠ¡å™¨,dockeré•œåƒ,registry,dockerå®¹å™¨
   
   dockerå®¢æˆ·ç«¯
   åœ¨linuxç³»ç»Ÿä¸‹,Docker Clientå’ŒDocker daemonã€å®¹å™¨ç›´æ¥è¿è¡Œåœ¨å®¿ä¸»æœºä¸Š,è¿™æ„å‘³ç€å®¹å™¨å¯ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºç«¯å£èµ„æº,
   ä¸éœ€è¦åœ¨å®¹å™¨å’Œå®¿ä¸»æœºä¹‹é—´æ˜ å°„ç«¯å£
   åœ¨winæˆ–macç³»ç»Ÿä¸‹,DockeræœåŠ¡è¿è¡Œåœ¨linuxè™šæ‹Ÿæœºé‡Œ,Docker clientè¿è¡Œåœ¨å®¿ä¸»æœºä¸‹è·ŸDockeræœåŠ¡é€šä¿¡.å½“è¿è¡Œå®¹å™¨é‡Œ,å®ƒç”¨çš„ç«¯å£èµ„æº
   æ˜¯è™šæ‹Ÿæœºé‡Œçš„,å¿…é¡»è·Ÿå®¿ä¸»æœºä¸Šçš„ç«¯å£æ˜ å°„

   dockeræœåŠ¡
   dockeræœåŠ¡æ˜¯dockeræœ€æ ¸å¿ƒçš„åå°è¿›ç¨‹,ä»–è´Ÿè´£å“åº”æ¥è‡ªdocker clientçš„è¯·æ±‚,ç„¶åå°†è¿™äº›è¯·æ±‚ç¿»è¯‘æˆç³»ç»Ÿè°ƒç”¨å®Œæˆå®¹å™¨ç®¡ç†æ“ä½œ
   è¯¥è¿›ç¨‹ä¼šåœ¨åå°å¯åŠ¨ä¸€ä¸ªAPI Server,è´Ÿè´£æ¥æ”¶ç”±docker clientå‘é€çš„è¯·æ±‚;æ¥æ”¶åˆ°çš„è¯·æ±‚å°†é€šè¿‡dockeræœåŠ¡å†…éƒ¨çš„ä¸€ä¸ªè·¯ç”±åˆ†å‘è°ƒåº¦,å†ç”±
   å…·ä½“çš„å‡½æ•°æ¥æ‰§è¡Œè¯·æ±‚
   
   # Docker copy-on-write
   docker run --name centos-test -it centos /bin/bash
   docker ps -a
   
   # åŸºç¡€å‘½ä»¤
   docker run centos pwd
   docker ps -l
   docker ps -a
   docker run centos /bin/bash -c "while true;do sleep 1;done"
   docker run  -d centos /bin/bash -c "while true;do sleep 1;done"
   çŸ­IDæ˜¯é•¿IDçš„å‰12ä¸ªå­—ç¬¦
   docker run --name centos-while  -d centos /bin/bash -c "while true;do sleep 1;done"
   docker stop centos-while
   docker stop çŸ­ID
   docker kill çŸ­ID
   docker run  -d centos /bin/bash -c "while true;do sleep 1;echo hello world;done"
   docker attach é•¿ID
   docker exec -it çŸ­ID bash
   ps -ef
   ps -elf
   exit
   
   attachå’Œexecçš„åŒºåˆ«:
   attachç›´æ¥è¿›å…¥å®¹å™¨å¯åŠ¨å‘½ä»¤çš„ç»ˆç«¯,ä¸ä¼šå¯åŠ¨æ–°çš„è¿›ç¨‹
   execåˆ™æ˜¯åœ¨å®¹å™¨ä¸­æ‰“å¼€æ–°çš„ç»ˆç«¯,å¹¶ä¸”å¯ä»¥å¯åŠ¨æ–°çš„è¿›ç¨‹
   å¦‚æœæƒ³ç›´æ¥åœ¨ç»ˆç«¯ä¸­æŸ¥çœ‹å¯åŠ¨å‘½ä»¤çš„è¾“å‡º,ç”¨attach;å…¶ä»–çš„æƒ…å†µä½¿ç”¨exec
   
   å®¹å™¨è¿è¡Œ
   dokcer run -it centos /bin/bash
   dockerå®¢æˆ·ç«¯ä½¿ç”¨dockerå‘½ä»¤æ¥è¿è¡Œ,runå‚æ•°è¡¨æ˜å®¢æˆ·ç«¯è¦è¿è¡Œä¸€ä¸ªæ–°çš„å®¹å™¨
   dockerå®¢æˆ·ç«¯è¦è¿è¡Œä¸€ä¸ªå®¹å™¨éœ€è¦å‘Šè¯‰dockerå®ˆæŠ¤è¿›ç¨‹çš„æœ€å°å‚æ•°ä¿¡æ¯æ˜¯:
   1) è¿™ä¸ªå®¹å™¨ä»å“ªä¸ªé•œåƒåˆ›å»º,è¿™é‡Œæ˜¯centos,åŸºç¡€çš„centosé•œåƒ
   2) åœ¨å®¹å™¨ä¸­è¦è¿è¡Œçš„å‘½ä»¤,è¿™é‡Œæ˜¯/bin/bash,åœ¨å®¹å™¨ä¸­è¿è¡Œbash shell
   
   æŒ‰ç…§é¡ºåº,dockeråšäº†è¿™äº›äº‹æƒ…:
   1) æ‹‰å–centosé•œåƒ:dockeræ£€æŸ¥centosé•œåƒæ˜¯å¦å­˜åœ¨,å¦‚æœåœ¨æœ¬åœ°æ²¡æœ‰è¯¥é•œåƒ,dockerä¼šä»docker hubä¸‹è½½.å¦‚æœé•œåƒå·²ç»å­˜åœ¨,dockerä¼šä½¿ç”¨å®ƒæ¥åˆ›å»ºæ–°çš„å®¹å™¨
   2) åˆ›å»ºæ–°çš„å®¹å™¨: å½“dockeræœ‰äº†è¿™ä¸ªé•œåƒä¹‹å,dockerä¼šç”¨å®ƒæ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨
   3) åˆ†é…æ–‡ä»¶ç³»ç»Ÿå¹¶ä¸”æŒ‚è½½ä¸€ä¸ªå¯è¯»å†™çš„å±‚:å®¹å™¨ä¼šåœ¨è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»º,å¹¶ä¸”ä¸€ä¸ªå¯è¯»å†™çš„å±‚è¢«æ·»åŠ åˆ°é•œåƒä¸­
   4) åˆ†é…ç½‘ç»œ/æ¡¥æ¥æ¥å£: åˆ›å»ºä¸€ä¸ªå…è®¸å®¹å™¨å’Œæœ¬åœ°ä¸»æœºé€šä¿¡çš„ç½‘ç»œæ¥å£
   5) è®¾ç½®ä¸€ä¸ªIPåœ°å€: ä»æ± ä¸­å¯»æ‰¾ä¸€ä¸ªå¯ç”¨çš„IPåœ°å€å¹¶ä¸”é™„åŠ åˆ°å®¹å™¨ä¸Š
   6) è¿è¡Œä½ æŒ‡å®šçš„ç¨‹åº: è¿è¡ŒæŒ‡å®šçš„ç¨‹åº
   7) æ•è·å¹¶ä¸”æä¾›åº”ç”¨è¾“å‡º:è¿æ¥å¹¶ä¸”è®°å½•æ ‡å‡†è¾“å‡ºã€è¾“å…¥å’Œé”™è¯¯è®©ä½ å¯ä»¥çœ‹åˆ°ä½ çš„ç¨‹åºå¦‚ä½•è¿è¡Œçš„
   
   docker start çŸ­ID
   docker restart çŸ­ID
   docker pause çŸ­ID
   docker unpause çŸ­ID
   docker rm çŸ­ID
   docker rm -v $(docker ps -aq -f status=exited)
   docker rmi hello-world
   
   æä¾›æœåŠ¡
   äº‘ä¸»æœº
   IPV4å’ŒIPV6
   NATæŠ€æœ¯
   
   docker run -d -p 80 httpd
   192.168.0.109:32769
   docker run -d -p 80:80 httpd
   
   dockeré•œåƒçš„åˆ›å»º-dockeré•œåƒåˆ›å»ºçš„ä¸¤ç§æ–¹æ³•
   ä½¿ç”¨commitå‘½ä»¤åˆ›å»ºdockeré•œåƒ
   ç¼–å†™Dockerfileåˆ›å»ºdockeré•œåƒ
   
   dockeré•œåƒçš„åˆ›å»º-ä½¿ç”¨commitå‘½ä»¤åˆ›å»ºdockeré•œåƒ
   docker run --name webserver -d -p 80:80 nginx
   docker exec -it webserver bash
   echo '<h1>Hello,Docker!<h1>' > /usr/share/nginx/html/index.html
   docker diff webserver
   
   docker commit --author "dazhuang" --message "modify default page" webserver  nginx:v2
   docker images
   docker history nginx:v2
   docker ps -a
   docker run --name web2 -d -p 81:80 nginx:v2
   ä½¿ç”¨docker commitå‘½ä»¤è™½ç„¶å¯ä»¥æ¯”è¾ƒç›´è§‚çš„å¸®åŠ©ç†è§£é•œåƒåˆ†å±‚å­˜å‚¨çš„æ¦‚å¿µ,ä½†æ˜¯å®é™…ç¯å¢ƒä¸­å¹¶ä¸ä¼šè¿™æ ·ä½¿ç”¨
   ç”±äºå‘½ä»¤çš„æ‰§è¡Œ,è¿˜æœ‰å¾ˆå¤šæ–‡ä»¶è¢«æ”¹åŠ¨æˆ–æ·»åŠ äº†.è¿™è¿˜ä»…ä»…æ˜¯æœ€ç®€å•çš„æ“ä½œ,å¦‚æœæ˜¯å®‰è£…è½¯ä»¶åŒ…ã€ç¼–è¯‘æ„å»º,é‚£ä¹ˆæœ‰å¤§é‡çš„æ— å…³å†…å®¹è¢«æ·»åŠ è¿›æ¥,å¦‚æœä¸å°å¿ƒæ¸…ç†
   å°†ä¼šå¯¼è‡´é•œåƒæä¸ºè‡ƒè‚¿
   æ­¤å¤–,ä½¿ç”¨docker commitæ„å‘³ç€æ‰€æœ‰å¯¹é•œåƒçš„æ“ä½œéƒ½æ˜¯é»‘ç®±æ“ä½œ,ç”Ÿæˆçš„é•œåƒä¹Ÿè¢«ç§°ä¸ºé»‘ç®±é•œåƒ
   
   dockeré•œåƒçš„åˆ›å»º-ç¼–å†™Dockerfileåˆ›å»ºdockeré•œåƒ
   ä»€ä¹ˆæ˜¯Dockerfile
   Dockerfileæ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶,å…¶å†…åŒ…å«äº†ä¸€æ¡æ¡çš„æŒ‡ä»¤,æ¯ä¸€æ¡æŒ‡ä»¤æ„å»ºä¸€å±‚,å› æ­¤æ¯ä¸€æ¡æŒ‡ä»¤çš„å†…å®¹,å°±æ˜¯æè¿°è¯¥å±‚åº”å½“å¦‚ä½•æ„å»º
   mkdir mynginx
   touch Dockerfile
   FROM nginx
   RUN echo '<h1>Hello,Docker!<h1>' > /usr/share/nginx/html/index.html
   
   FROMå’ŒRUN
   FROMæŒ‡å®šåŸºç¡€é•œåƒ
   åŸºç¡€é•œåƒæ˜¯å¿…é¡»æŒ‡å®šçš„.è€ŒFROMå°±æ˜¯æŒ‡å®šåŸºç¡€é•œåƒ,å› æ­¤ä¸€ä¸ªDockerfileä¸­FROMæ˜¯å¿…å¤‡çš„æŒ‡ä»¤,å¹¶ä¸”å¿…é¡»æ˜¯ç¬¬ä¸€æ¡æŒ‡ä»¤
   RUNæ‰§è¡Œå‘½ä»¤
   RUNæŒ‡ä»¤æ˜¯ç”¨æ¥æ‰§è¡Œå‘½ä»¤è¡Œå‘½ä»¤çš„.ç”±äºå‘½ä»¤è¡Œçš„å¼ºå¤§èƒ½åŠ›,RUNæŒ‡ä»¤åœ¨å®šåˆ¶é•œåƒæ—¶æ˜¯æœ€å¸¸ç”¨çš„æŒ‡ä»¤ä¹‹ä¸€
   
   RUNæŒ‡ä»¤çš„ä¸¤ç§æ¨¡å¼
   shellæ ¼å¼: RUN <å‘½ä»¤>,å°±åƒç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥çš„å‘½ä»¤ä¸€æ ·
   execæ ¼å¼: RUN ["å¯æ‰§è¡Œæ–‡ä»¶","å‚æ•°1","å‚æ•°2"],è¿™æ›´åƒæ˜¯å‡½æ•°è°ƒç”¨ä¸­çš„æ ¼å¼
   ä¸è¶…è¿‡127å±‚
   
   docker build -t nginx:v3 .
   docker images
   https://hub.docker.com => create repository => nginxv3 => create
   docker info
   docker tag nginx:v3 450120127/nginxv3:v3
   docker push 450120127/nginxv3:v3
   docker pull 450120127/nginxv3:v3
   ```

3. Docker-appiumçš„ä½¿ç”¨
   
   ```markdown
   # åœ¨linuxç³»ç»Ÿä¸­å®‰è£…appium
   https://oxygeneningine.github.io/æŠ€æœ¯/2017/10/18/install-auto-test-environment-on-centos-7
   
   # æœç´¢æ‹‰å–appiumé•œåƒ (é…ç½®dockeråŠ é€Ÿå™¨)
   docker search appium
   docker pull appium/appium
   
   # githubçš„appium-docker-androidé¡¹ç›®
   https://github.com/appium/appium-docker-android
   
   # sshè¿æ¥docker host
   user: docker
   pass: tcuser
   
   # åˆ›å»ºappiumå®¹å™¨ & è®¾ç½®appiumå®¹å™¨è¿æ¥å®‰å“æ¨¡æ‹Ÿå™¨
   docker images
   docker ps -a
   docker run --privileged -d -p 4723:4723 --name appium1 appium/appium
   docker ps -a
   å¯åŠ¨androidæ¨¡æ‹Ÿå™¨
   adb devices
   adb -s 127.0.0.1:62001 tcpip 5555 
   docker exec -it appium1 adb devices
   docker exec -it appium1 adb connect 172.17.100.15:5555
   docker exec -it appium1 adb devices

   test.py
   docker exec -it appium1 bash
   cd /var/log
   tail -f appium.log
   ```
   
4. æ‰“é€ å¤šä»»åŠ¡ç«¯appåº”ç”¨æ•°æ®æŠ“å–ç³»ç»Ÿ-å®ç°ç¯‡

   ```markdown
   # ä»»åŠ¡éœ€æ±‚è¯¦è§£
   1) æŠ“å–æŠ–éŸ³å½“å‰è§†é¢‘çš„ä½œè€…æ•°æ®
   2) æŠ“å–å¿«æ‰‹å½“å‰è§†é¢‘çš„ä½œè€…æ•°æ®
   3) æŠ“å–ä»Šæ—¥å¤´æ¡æ¨èæ¿å—æ–°é—»
   
   decode_data.py
   handle_appium_docker.py
   handle_mongo.py
   
   # ç³»ç»Ÿæ­å»ºæ­¥éª¤
   1) ä¸‹è½½mongodbã€appiumã€450120127/pythonv2é•œåƒ docker pull 450120127/pythonv2
   2) è®¾ç½®docker toolboxç½‘å¡çŠ¶æ€åˆ°æ¡¥æ¥
   3) è®¾ç½®docker toolboxå…±äº«,æŒ‚è½½å…±äº«æ–‡ä»¶å¤¹
   4) åˆ›å»ºå¹¶å¯åŠ¨ç›¸åº”å®¹å™¨
   
   # å¸¸è§æŠ¥é”™
   æ›´æ”¹è™šæ‹Ÿæœºç½‘ç»œæ¡¥æ¥å,è™šæ‹Ÿæœºæ— æ³•å¯åŠ¨
   å¯åŠ¨å¤œç¥æ¨¡æ‹Ÿå™¨å,å¤œç¥æ¨¡æ‹Ÿå™¨ä¸dockeræ— æ³•é€šä¿¡,åŒæ—¶é‡å¯è™šæ‹Ÿæœº,æœ‰å¦‚ä¸‹æŠ¥é”™:ä¸èƒ½ä¸ºè™šæ‹Ÿç”µè„‘1.0æ‰“å¼€ä¸€ä¸ªæ–°ä»»åŠ¡;ä¸èƒ½ä¸ºè™šæ‹Ÿç”µè„‘h1æ‰“å¼€ä¸€ä¸ªæ–°ä»»åŠ¡
   
   # è§£å†³æ–¹æ³•
   å‡çº§vitualbox
   å®‰å…¨é©±åŠ¨VirtualBox NDIS6 Bridged Networking Driver:
   VirtualBox NDIS6 Bridged Networking Driver => å®‰è£… => æœåŠ¡ => æ·»åŠ  => ä»ç£ç›˜å®‰è£… 
   => Oracle/VirtualBox/drivers/network/netlwf/VBoxNetLwf.inf => ç¡®å®š
   
   ä¸‹è½½mongodbã€appiumã€450120127/pythonv2é•œåƒ docker pull 450120127/pythonv2
   è®¾ç½®docker toolboxç½‘å¡çŠ¶æ€åˆ°æ¡¥æ¥
   è®¾ç½®docker toolboxå…±äº«,æŒ‚è½½å…±äº«æ–‡ä»¶å¤¹
   
   # ä¼šè¯ python
   ifconfig | more
   sshè¿æ¥docker host
   mkdir docker
   /home/docker/docker
   sudo mount -t vboxsf /Users/bruce/workspace/mobile-spider/chapter07 /home/docker/docker
   mount 
   sudo umount /home/docker/docker
   sudo mount -t vboxsf /Users/bruce/workspace/mobile-spider/chapter07 /home/docker/docker
   docker images
   docker run -it -v /home/docker/docker:/root/ --name python 450120127/pythonv2 /bin/bash
   
   # ä¼šè¯  mitmdump
   docker images
   docker run --rm -it -v /home/docker/docker:/root/ -p 8889:8889 -name mitmdump 450120127/pythonv2 mitmdump -p 8889 -s /root/decode_data.py
   
   # ä¼šè¯ appium
   docker run --privileged -d -p 4723:4723 --name appium_douyin appium/appium
   docker run --privileged -d -p 4724:4723 --name appium_kuaishou appium/appium
   docker run --privileged -d -p 4725:4723 --name appium_jrtt appium/appium
   
   # ä¼šè¯ mongodb
   docker run -p 27017:27017 -v /home/docker/docker:/root/ -d --name mongodb mongo
   
   # win10
   å¼€å¯ä¸‰ä¸ªå¤œç¥æ¨¡æ‹Ÿå™¨
   ç½‘ç»œæ¡¥æ¥æ¨¡å¼ã€å®‰è£…ç›¸åº”è¯ä¹¦fiddler/mitmproxy/mitmproxyã€æŠ–éŸ³/å¿«æ‰‹/ä»Šæ—¥å¤´æ¡apkå®‰è£…
   adb connect 127.0.0.1:62001
   adb connect 127.0.0.1:62025
   adb connect 127.0.0.1:62026
   
   adb -s 127.0.0.1:62001 tcpip 5555
   adb -s 127.0.0.1:62025 tcpip 5555
   adb -s 127.0.0.1:62026 tcpip 5555
   
   # ä¼šè¯ appium
   docker ps -a
   docker exec -it appium_douyin adb devices
   docker exec -it appium_douyin adb connect xxxx:5555
   docker exec -it appium_kuaishou adb connect xxxx:5555
   docker exec -it appium_jrtt adb connect xxxx:5555
   
   # ä¼šè¯ python
   æœ¬åœ°ä¿®æ”¹pythonæ–‡ä»¶,æ­¤ä¼šè¯pythonä¼šåŒæ­¥ä¿®æ”¹
   python handle_appium_docker.py
   
   # ä¼šè¯  mitmdump
   # ä¼šè¯ mongodb
   ```
   
##### æŠ–éŸ³æ•°æ®æŠ“å–å®æˆ˜(fiddler+u2+mitmproxy)
1. çŸ­è§†é¢‘æŠ“å–éœ€æ±‚åˆ†æ

   ```markdown
   # éœ€æ±‚åˆ†æ
   æŠ–éŸ³å½“å‰è§†é¢‘æ ‡é¢˜
   æŠ–éŸ³ç”¨æˆ·ä¸»é¡µ
   
   # éœ€æ±‚æ‹†è§£
   æ¨¡æ‹Ÿæ»‘åŠ¨è§†é¢‘å’Œç‚¹å‡»å‘å¸ƒè€…
   é€šè¿‡mitmproxyè§£æè¿”å›æ•°æ®
   
   # appæ“ä½œæµç¨‹
   è¿æ¥è®¾å¤‡
   å¯åŠ¨app
   åˆ¤æ–­å½“å‰æ‰€å¤„é¡µé¢
   è¿›å…¥å‘å¸ƒè€…ä¸ªäººé¡µé¢
   æ»‘åŠ¨è§†é¢‘
   é‡åˆ°å¹¿å‘Š
   åœæ­¢æ“ä½œ
   é€€å‡ºapp,æ¸…é™¤ç¼“å­˜
   
   # æŠ“å–appè¿”å›æ•°æ®åŒ…
   é€šè¿‡fiddleræŠ“å–ç›¸å…³æ¥å£
   ç¼–å†™mitmdumpé€»è¾‘æŠ“å–è¿”å›æ•°æ®å¹¶æŸ¥çœ‹
   
   # å®‰è£…vmware tools
   ç›´æ¥æ‹–æ‹½ä¸»æœºæ–‡ä»¶åˆ°è™šæ‹Ÿæœº
   ç›´æ¥ä½¿ç”¨vmwareè™šæ‹Ÿæœºçš„terminal
   cd /media/hadoop/VMware Tools
   cp VMwareTools-10.3.23-16594550.tar.gz /home/hadoop/app/
   tar -zxvf VMwareTools-10.3.23-16594550.tar.gz
   sudo ./vmware-install.pl
   æ˜¾ç¤ºå™¨ åŠ é€Ÿ3Då›¾å½¢ å‹¾é€‰
   å›¾å½¢å†…å­˜ 768MB
   ```
   
2. é€šè¿‡u2å®ç°æ»‘åŠ¨çŸ­è§†é¢‘

   ```markdown
   weditor+uiautomator2
   handle_douyin.py
   ```

3. é€šè¿‡mitmproxyè§£æçŸ­è§†é¢‘appè¿”å›æ•°æ®

   ```markdown
   # æ¥å£åˆ†æ
   1) fiddlerå¤„äºä¸ç§»åŠ¨è®¾å¤‡åŒä¸€ä¸ªç½‘ç»œä¸‹
   2) ç½‘ç»œå¤„äºå¯é€šä¿¡çŠ¶æ€
   3) ç§»åŠ¨è®¾å¤‡å®‰è£…ç›¸å…³è¯ä¹¦å¹¶ä¿¡ä»»
   4) fiddlerç›¸å…³è®¾ç½®(Tools-Options-HTTPS/Connections)
   
   ç§»åŠ¨è®¾å¤‡éœ€è¦ç‚¹å‡»åˆ°éœ€è¦æŠ“å–çš„é¡µé¢
   å³ä¸Šé¢: é€‰ä¸­è¦æ‰¾çš„åŒ…->Inspectors->Raw/Headers
   å³ä¸‹é¢: Raw/JSON
   
   # ç¼–å†™mitmdumpè§£ææ–‡ä»¶ & è¿è¡Œå¹¶æŸ¥çœ‹
   decode_douyin.py
   
   mitmdump -s decode_douyin.py -p 8889
   è¿è¡Œhandle_douyin.py
   ```
   
##### å¤šè®¾å¤‡ç®¡ç†atxserver2åº“(2020ç‰ˆ)
1. atxserver2åº“ä»‹ç»

   ```markdown
   éœ€æ±‚: 
   ç§»åŠ¨è®¾å¤‡(Androidå’ŒIOS)å¼‚åœ°è°ƒè¯•
   ç§»åŠ¨è®¾å¤‡ç®¡ç†ã€é‡å¯ã€å…³æœºã€ç½‘ç»œç®¡ç†ç­‰
   ç»“åˆè®¾å¤‡ç®¡ç†å¹³å°å®Œæˆapp UIè‡ªåŠ¨åŒ–æµ‹è¯•
   å¼‚å¸¸è°ƒè¯•æ—¶å»¶è¿Ÿå¯æ¥å—,ç”»è´¨å¯æ¥å—
   
   atxserver2:
   ATX2æ˜¯ä¸€æ¬¾å¯ä»¥è¿œç¨‹æ§åˆ¶Androidå’ŒIOSè®¾å¤‡çš„è®¾å¤‡ç®¡ç†å¹³å°
   è¯¥å¹³å°ä½¿ç”¨çš„æŠ€æœ¯æ ˆä¸ºPython3+NodeJS+RethinkDB
   ä½œè€…:codeskyblue
   
   atxserver2æ¶æ„: åªæ”¯æŒusbè¿æ¥
   atxserver2åŠŸèƒ½
   ```
   atxserver2æ¶æ„.png
   atxserver2åŠŸèƒ½.png
   atxserver2åŠŸèƒ½2.png
   atxserver2åŠŸèƒ½3.png
   atxserver2åŠŸèƒ½4.png
   atxserver2åŠŸèƒ½5.png

2. atxserver2é€šè¿‡pipå®‰è£…éƒ¨ç½²

   ```markdown
   å®‰è£…rethinkdbæ•°æ®åº“:https://rethinkdb.com/docs/install/ubuntu/
   ä¸‹è½½rethinkdbçš„debæ–‡ä»¶æ‰‹åŠ¨å®‰è£…
   https://github.com/srh/rethinkdb/realeases/tag/v2.3.6.srh.1
   sudo dpkg -i rethinkdb_2.3.6.srh.1.0bionic_and64.deb
   rethinkdbå¯åŠ¨
   
   wget https://www.python.org/ftp/python/3.8.0/Python-3.8.0.tgz
   tar -xf Python-3.8.0.tgz
   cd Python-3.8.0
   ./configure --enable-optimizations
   make -j 4
   sudo make install
   python3.8 --version
   sudo rm -rf /usr/bin/python
   sudo rm -rf /usr/bin/pip
   sudo ln -s /usr/local/bin/pip3.8 /usr/bin/pip
   sudo ln -s /usr/local/bin/python3.8 /usr/bin/python
   
   ä¸‹è½½atxserver2é¡¹ç›®: git clone https://github.com/openatx/atxserver2.git
   å¯åŠ¨atxserver2:
   cd atxserver2
   virtualenv --python=/usr/bin/python venv
   source venv/bin/activate
   sudo pip install -r requirements.txt -i https://pypi.douban.com/simple
   sudo python main.py
   http://192.168.0.101:4000
   
   å®‰è£…atxserver2-android-provider:
   å®‰è£…nodejs8
   curl -sL https://deb.nodesource.com/setup_8.x|sudo -E bash -
   sudo apt-get install -y nodejs
   ä¸‹è½½atxserver2-android-provideré¡¹ç›®
   git clone https://github.com/openatx/atxserver2-android-provider.git
   cd atxserver2-android-provider
   npm install
   virtualenv --python=/usr/bin/python venv
   source venv/bin/activate
   sudo pip install -r requirements.txt -i https://pypi.douban.com/simple
   sudo python main.py --server http://192.168.0.101:4000
   æ‰‹æœºè¿æ¥ç”µè„‘
   
   è®¾å¤‡å‘ç°:
   Providerå¯ä»¥é€šè¿‡adb track-devicesè‡ªåŠ¨å‘ç°å·²ç»æ¥å…¥çš„è®¾å¤‡
   minicap,
   minittouch,
   atx-agent,
   app-uiautomator-[test].apk,
   whatsinput-apk
   ```

3. atxserver2å¤šè®¾å¤‡ç®¡ç†åº“çš„ä½¿ç”¨

   ```markdown
   rethinkdb:
   è®¾è®¡ç”¨æ¥å­˜å‚¨JSONæ–‡æ¡£çš„åˆ†å¸ƒå¼æ•°æ®åº“,å¯ä»¥é€šè¿‡ç®€å•æ“ä½œå®ç°å¤šæœºåˆ†å¸ƒå¼å­˜å‚¨.æ”¯æŒè¡¨çš„è”åˆå’Œåˆ†ç»„æŸ¥è¯¢

   cd /etc/rethinkdb
   sudo cp default.conf.sample default.conf
   sudo vim default.conf
   bind=0.0.0.0
   sudo cp default.conf instances.d/
   nohup rethinkdb --config-file /etc/rethinkdb/instances.d/default.conf

   192.168.0.101:8080
   Data Explorer
   æŸ¥è¯¢æ•°æ®åº“ r.dbList()
   æŸ¥è¯¢æ•°æ®è¡¨ r.db('atxserver2').tableList()
   æŸ¥è¯¢è¡¨å†…æ•°æ® 
   r.db('atxserver2').table('users') mi
   r.db('atxserver2').table('devices')
   r.db('atxserver2').table('groups')

   192.168.0.101:4000
   ç”¨æˆ·ä¿¡æ¯
   è®¾å¤‡åˆ—è¡¨ ç‚¹å‡»ä½¿ç”¨
   æ“æ§è®¾å¤‡
   æµè§ˆå™¨æ‰“å¼€URL
   å¿«æ·å…¥å£ Settings å¼€å‘è€… Wifi
   å¢åŠ å¿«æ·å‘½ä»¤
   Terminal:
   pm list packages -3
   ifconfig
   å®‰è£…ç®¡ç†
   æ–‡ä»¶ç®¡ç†
   æˆªå›¾
   åº”ç”¨ç®¡ç†
   ç‚¹å‡»ä½¿ç”¨å¤šå°è®¾å¤‡
   
   Ubuntu:
   adb devices
   adb -s è®¾å¤‡id shell
   ifconfig
   ```

4. å®ç°å¤šä»»åŠ¡ç«¯appåº”ç”¨æ•°æ®æŠ“å–ç³»ç»Ÿ

   ```markdown
   # å¤šä»»åŠ¡ç«¯appåº”ç”¨æ•°æ®æŠ“å–ä½¿ç”¨æŠ€æœ¯
   atxserver2+u2+mitmproxy (2å°è®¾å¤‡)  
   
   weditor 
   fiddleræ¥å£åˆ†æ:
   1) fiddlerå¤„äºä¸ç§»åŠ¨è®¾å¤‡åŒä¸€ä¸ªç½‘ç»œä¸‹
   2) ç½‘ç»œå¤„äºå¯é€šä¿¡çŠ¶æ€
   3) ç§»åŠ¨è®¾å¤‡è®¾ç½®fiddlerä»£ç†ã€å®‰è£…ç›¸å…³è¯ä¹¦å¹¶ä¿¡ä»»
   4) fiddlerç›¸å…³è®¾ç½®(Tools-Options-HTTPS/Connections)
   
   ç§»åŠ¨è®¾å¤‡éœ€è¦ç‚¹å‡»åˆ°éœ€è¦æŠ“å–çš„é¡µé¢
   å³ä¸Šé¢: é€‰ä¸­è¦æ‰¾çš„åŒ…(json)->Inspectors->Raw/Headers
   å³ä¸‹é¢: Raw/JSON
   
   pythonå¤šè¿›ç¨‹
   
   # å¤šä»»åŠ¡ç«¯appåº”ç”¨æ•°æ®æŠ“å–æ¶æ„
   mitmdump       æ‰‹æœºå±å¹•ç›‘æ§ æ‰‹æœºå±å¹•ç›‘æ§ æ‰‹æœºå±å¹•ç›‘æ§  httpé€šè®¯   Atx-agent ç§»åŠ¨è®¾å¤‡ 192.168.0.102   httpé€šè®¯  çŸ­è§†é¢‘ä¿¡æ¯
   192.168.0.101      atxserver2                    httpé€šè®¯   Atx-agent ç§»åŠ¨è®¾å¤‡ 192.168.0.104   httpé€šè®¯  å¿«æ‰‹
                     192.168.0.101                  httpé€šè®¯   Atx-agent ç§»åŠ¨è®¾å¤‡ 192.168.0.106   httpé€šè®¯  ä»Šæ—¥å¤´æ¡       
   
   # å¤šä»»åŠ¡ç«¯appåº”ç”¨æ•°æ®æŠ“å–å®ç°
   decode_douyin.py(æ— éœ€æ”¹åŠ¨)
   handle_douyin.py(ä¸»è¦æ”¹åŠ¨)
   
   ç§»åŠ¨è®¾å¤‡: mitproxyä»£ç†å¼€å¯ 192.168.0.101 8889
   ubuntu: 
   nohup rethinkdb --config-file /etc/rethinkdb/instances.d/default.conf &
   
   cd atxserver2
   source venv/bin/activate
   python main.py
   http://192.168.0.101:4000
   
   cd atxserver2-android-provider
   source venv/bin/activate
   python main.py --server http://192.168.0.101:4000
   æ‰‹æœºè¿æ¥ç”µè„‘
   
   mitmdump -s decode_douyin.py -p 8889
   
   è¿è¡Œhandle_douyin.py
   
   http://192.168.0.101:4000 æ‰“å¼€é“¾æ¥
   ubuntu: mitmdump
   ```

##### elasticsearch 
1. esä»‹ç»å’Œå®‰è£…

   ```markdown
   ELK Elasticsearch Lohstash Kibana
   Elastic Stack Elasticsearch Lohstash Kibana beats
   
   Elasticsearch:
   æ˜¯åŸºäºjavaçš„å¼€æºåˆ†å¸ƒå¼æœç´¢å¼•æ“
   åˆ†å¸ƒå¼ã€é›¶é…ç½®ã€è‡ªåŠ¨å‘ç°ã€ç´¢å¼•è‡ªåŠ¨åˆ†ç‰‡ã€ç´¢å¼•å‰¯æœ¬æœºåˆ¶ã€restfulé£æ ¼æ¥å£ã€å¤šæ•°æ®æºã€è‡ªåŠ¨æœç´¢è´Ÿè½½ç­‰
   
   Logstash:
   æ˜¯åŸºäºjava,å¼€æºçš„ç”¨äºæ”¶é›†ã€åˆ†æå’Œå­˜å‚¨æ—¥å¿—çš„å·¥å…·
   
   Kibana:
   æ˜¯åŸºäºnodejs,å¼€æºçš„å…è´¹çš„å·¥å…·
   Kibanaå¯ä»¥ä¸ºLogstashå’ŒElasticsearchæä¾›çš„æ—¥å¿—åˆ†æå‹å¥½çš„Webç•Œé¢,å¯ä»¥æ±‡æ€»ã€åˆ†æå’Œæœç´¢é‡è¦æ•°æ®æ—¥å¿—
   
   beats:
   elasticå…¬å¸å¼€æºçš„ä¸€æ¬¾é‡‡é›†ç³»ç»Ÿç›‘æ§æ•°æ®çš„ä»£ç†agent,æ˜¯åœ¨è¢«ç›‘æ§æœåŠ¡å™¨ä»¥ä¸Šå®¢æˆ·ç«¯å½¢å¼è¿è¡Œçš„æ•°æ®æ”¶é›†å™¨çš„ç»Ÿç§°
   
   Elasticsearchå®‰è£…:
   https:/www.elastic.co/guide/en/elasticsearch/reference/current/deb.html#install-deb
   wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.7.1-amd64.deb
   sudo dpkg -i elasticsearch-7.7.0-amd64.deb
   cd /usr/share/elasticsearch
   sudo vim /etc/elasticsearch/elasticsearch.yml
   network.host: 0.0.0.0
   cluster.initial_master_nodes: node-1
   å¯åŠ¨es
   service elasticsearch start
   /usr/share/elasticsearch/bin/elasticsearch -d
   curl http://localhost:9200
   curl http://192.168.0.101:9200
   ps -ef|grep elasticsearch
   cat /etc/passwd
   192.168.0.101:9200
   ```

2. æ•°æ®å¯è§†åŒ–ç»„ä»¶kibanaçš„å®‰è£…å’Œåœ¨esåŸºæœ¬çš„å¢åˆ æ”¹æŸ¥

   ```markdown
   Elasticsearchæœ¯è¯­:
   æ–‡æ¡£document
   ç”¨æˆ·å­˜å‚¨åœ¨esä¸­çš„æ•°æ®æ–‡æ¡£,ä»–æ˜¯esä¸­å­˜å‚¨æœ€å°å•å…ƒ
   ç´¢å¼•index
   indexç±»æ¯”ä¸ºMySQLçš„è¡¨
   èŠ‚ç‚¹Node
   ä¸€ä¸ªnodeå°±æ˜¯esdeä¸€ä¸ªè¿è¡Œå®ä¾‹
   é›†ç¾¤cluster
   æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ç»„æˆ,å¯¹å¤–æä¾›æœåŠ¡
   
   Kibanaå®‰è£…:
   https:/www.elastic.co/guide/en/kibana/reference/current/deb.html#install-deb
   wget https://artifacts.elastic.co/downloads/kibana/kibana-7.7.1-amd64.deb
   sudo dpkg -i kibana-7.7.0-amd64.deb
   cd /usr/share/kibana
   sudo vim /etc/kibana/kibana.yml
   server.port: 5601
   server.host: "192.168.0.101"
   elasticsearch.hosts: ["http://localhost:9200"]
   il8n.locale: "zh-CN"
   å¯åŠ¨es
   service kibana start
   ps -ef|grep elasticsearch
   cat /etc/passwd
   192.168.0.101:5601
   
   es.md
   ```

3. esæŸ¥è¯¢è¿›é˜¶ & esæŸ¥è¯¢æ’åº & esåˆ†é¡µæŸ¥è¯¢ & eså¸ƒå°”æŸ¥è¯¢ & esç»“æœè¿‡æ»¤ & esé«˜äº®æ˜¾ç¤º & esèšåˆå‡½æ•°æŸ¥è¯¢ & esåˆ†ç»„æŸ¥è¯¢

   ```markdown
   es.md
   
   ElasticsearchæŸ¥è¯¢:
   æŸ¥è¯¢å­—ç¬¦ä¸²(query string),ç®€å•æŸ¥è¯¢
   é€šè¿‡DSLè¯­å¥æ¥è¿›è¡ŒæŸ¥è¯¢
   
   Elasticsearchå¸ƒå°”æŸ¥è¯¢:
   must(and)
   should(or)
   must_not(not)
   filter
   
   æŸ¥è¯¢å›½åˆ«ä¸ºèœ€å›½å’Œæ€§åˆ«ä¸ºç”·å’Œå¹´é¾„ä¸º39å²çš„äºº
   æŸ¥è¯¢å¹´é¾„ä¸º39å²æ ‡ç­¾ä¸ºé—­æœˆç¾èŠ±çš„äºº
   æŸ¥è¯¢å¹´é¾„ä¸ä¸º39å²å’Œæ ‡ç­¾ä¸ä¸ºé—­æœˆç¾èŠ±å’Œæ€§åˆ«ä¸ä¸ºç”·çš„äºº
   æŸ¥è¯¢å¹´é¾„å¤§äº39å²,å›½åˆ«ä¸ºé­å›½çš„äºº
   
   must: ä¸å…³ç³»  and
   should: æˆ–å…³ç³» or
   must_not: éå…³ç³» not
   filter: è¿‡æ»¤æ¡ä»¶
   range: æ¡ä»¶ç­›é€‰èŒƒå›´
   gt: å¤§äº
   gte: å¤§äºç­‰äº
   lt: å°äº
   lte: å°äºç­‰äº
   
   Elasticsearchèšåˆå‡½æ•°:
   Avgå¹³å‡å€¼
   Maxæœ€å¤§å€¼
   Minæœ€å°å€¼
   Sumæ±‚å’Œ

   æ±‚å´å›½æ‰€æœ‰äººå¹´é¾„çš„å¹³å‡å€¼,åŒ…æ‹¬æ‰€æœ‰ç”·äººå’Œå¥³äºº
   æ±‚å´å›½æ‰€æœ‰äººå¹´é¾„ä¸­æœ€å¤§å¹´é¾„çš„äºº
   æ±‚å´å›½æ‰€æœ‰äººå¹´é¾„ä¸­æœ€å°å¹´é¾„çš„äºº
   æ±‚å´å›½æ‰€æœ‰äººå¹´é¾„çš„å’Œ
   
   Elasticsearchåˆ†ç»„æŸ¥è¯¢:
   æŸ¥è¯¢æ‰€æœ‰äººçš„å¹´é¾„æ®µ,å¹¶æŒ‰ç…§10-20ã€20-30ã€30-40ã€40-50å››ä¸ªåˆ†ç»„,å¹¶ä¸”ç®—å‡ºæ¯ç»„çš„å¹³å‡å¹´é¾„10
   ```
   
4. `_doc`æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„

   ```markdown
   Elasticsearchçš„type:
   ç´¢å¼•åœ¨6.xä¸­åˆ›å»ºåªå…è®¸æ¯ä¸ªç´¢å¼•ä½¿ç”¨å•ä¸€ç±»å‹,ç±»å‹å¯ä»¥ä½¿ç”¨ä»»ä½•åç§°,ä½†åªèƒ½æœ‰ä¸€ä¸ª,é¦–é€‰çš„ç±»å‹åç§°æ˜¯_doc
   åœ¨7.0ä¸­,_docæ˜¯è·¯å¾„çš„ä¸€ä¸ªæ°¸ä¹…éƒ¨åˆ†,å®ƒè¡¨ç¤ºç«¯ç‚¹åç§°,è€Œä¸æ˜¯æ–‡æ¡£ç±»å‹
   ```

5. es mappingsçš„ä¸‰ç§æ¨¡å¼

   ```markdown
   Elasticsearchçš„mappings:
   æ˜ å°„mappingså°±æ˜¯elasticsearchä¸­å®šä¹‰çš„è¡¨ç»“æ„
   å“ªäº›å­—ç¬¦ä¸²è¯¥è¢«è§†ä¸ºå…¨æ–‡å­—æ®µ
   å“ªäº›å­—æ®µåŒ…å«æ•°å­—ã€æ—¥æœŸæˆ–åœ°ç†ä½ç½®
   å®šä¹‰æ—¥æœŸçš„æ ¼å¼
   è‡ªå®šä¹‰è§„åˆ™,ç”¨æ¥æ§åˆ¶åŠ¨æ€æ·»åŠ å­—æ®µçš„æ˜ å°„
   
   Elasticsearchå­—æ®µæ•°æ®ç±»å‹:
   ç®€å•ç±»å‹,å¦‚æ–‡æœ¬textã€å…³é”®å­—keywordã€æ—¥æœŸdateã€æ•´å½¢longã€åŒç²¾åº¦doubleã€å¸ƒå°”booleanæˆ–ip
   å¯ä»¥æ˜¯æ”¯æŒJSONçš„å±‚æ¬¡ç»“æ„æ€§è´¨çš„ç±»å‹,å¦‚å¯¹è±¡æˆ–åµŒå¥—
   æˆ–è€…ä¸€ç§ç‰¹æ®Šç±»å‹,å¦‚geo_pointã€geo_shapeæˆ–completion
   
   Mappingsçš„ä¸‰ç§ç±»å‹:
   åŠ¨æ€æ˜ å°„(dynamic)
   é™æ€æ˜ å°„
   ä¸¥æ ¼æ˜ å°„(strict)
   
   es.md
   ```

6. esçš„åˆ†è¯å™¨ & ä¿®æ”¹esçš„åˆ†è¯å™¨

   ```markdown
   æ•°æ®å…¥åº“:
   åŸå§‹æ–‡æœ¬->åˆ†æå™¨(å­—ç¬¦è¿‡æ»¤å™¨->æ ‡å‡†åˆ†è¯å™¨->åˆ†è¯è¿‡æ»¤å™¨ åˆ†è¯è¿‡æ»¤é“¾-å°å†™ã€åœç”¨è¯ã€åŒä¹‰è¯)->å»ºç«‹å€’æ’ç´¢å¼•
   cnblogs.com/Neeo/articles/10593037.html
   
   åœç”¨è¯:
   1. æœ‰äº›è¯åœ¨æ–‡æœ¬ä¸­å‡ºç°çš„é¢‘ç‡éå¸¸é«˜,ä½†æ˜¯å¯¹æ–‡æœ¬æ‰€æºå¸¦çš„ä¿¡æ¯åŸºæœ¬ä¸äº§ç”Ÿå½±å“
   2. ä¸€äº›è‹±æ–‡,å¦‚aã€anã€theã€of
   3. ä¸­æ–‡, å¦‚çš„ã€äº†ã€ç€ã€æ˜¯ã€æ ‡ç‚¹ç¬¦å·ç­‰
   4. æ–‡æœ¬ç»è¿‡åˆ†è¯ä¹‹å,åœç”¨è¯é€šå¸¸è¢«è¿‡æ»¤æ‰,ä¸ä¼šè¢«è¿›è¡Œç´¢å¼•
   5. åœ¨æ£€ç´¢çš„æ—¶å€™,ç”¨æˆ·çš„æŸ¥è¯¢ä¸­å¦‚æœå«æœ‰åœç”¨è¯,æ£€ç´¢ç³»ç»Ÿä¹Ÿä¼šå°†å…¶è¿‡æ»¤æ‰(å› ä¸ºç”¨æˆ·è¾“å…¥çš„æŸ¥è¯¢å­—ç¬¦ä¸²ä¹Ÿè¦è¿›è¡Œåˆ†è¯å¤„ç†)
   6. æ’é™¤åœç”¨è¯å¯ä»¥åŠ é€Ÿå»ºç«‹ç´¢å¼•çš„é€Ÿåº¦,å‡å°‘ç´¢å¼•åº“æ–‡ä»¶çš„å¤§å°
   
   é»˜è®¤åˆ†è¯å™¨:
   Standard Analyzer-é»˜è®¤åˆ†è¯å™¨,æŒ‰è¯åˆ‡åˆ†,å°å†™å¤„ç†
   Simple Analyzer-æŒ‰ç…§éå­—æ¯åˆ‡åˆ†(ç¬¦å·è¢«è¿‡æ»¤),å°å†™å¤„ç†
   Stop Analyzer-å°å†™å¤„ç†,åœç”¨è¯è¿‡æ»¤
   Whitespace Analyzer-æŒ‰ç…§ç©ºæ ¼åˆ‡åˆ†,ä¸è½¬å°å†™
   Keyword Analyzer-ä¸åˆ†è¯,ç›´æ¥å°†è¾“å…¥å½“ä½œè¾“å‡º
   Patter Analyzer-æ­£åˆ™è¡¨è¾¾å¼,é»˜è®¤\W+(éå­—ç¬¦åˆ†å‰²)
   Language-æä¾›äº†30å¤šç§å¸¸è§è¯­è¨€çš„åˆ†è¯å™¨
   Customer Analyzer è‡ªå®šä¹‰åˆ†è¯å™¨
   
   IKåˆ†è¯å™¨: 
   https://github.com/medcl/elasticsearch-analysis-ik/releases
   å®‰è£…æ˜¯æ³¨æ„ä¸‹è½½IKçš„ç‰ˆæœ¬å’Œelasticsearchçš„ç‰ˆæœ¬è¦åŒ¹é…
   
   IKåˆ†è¯å™¨çš„å®‰è£…:
   sudo /usr/share/elasticsearch/bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.7.0/elasticsearch-analysis-ik-7.7.0.zip
   å®‰è£…å®Œæ’ä»¶éœ€è¦é‡å¯ES,æ‰èƒ½ç”Ÿæ•ˆ
   
   IKæœ‰ä¸¤ç§é¢—ç²’åº¦çš„æ‹†åˆ†:
   ik_smart: ä¼šåšæœ€ç²—ç²’åº¦çš„æ‹†åˆ†
   ik_max_word: ä¼šå°†æ–‡æœ¬åšæœ€ç»†ç²’åº¦çš„æ‹†åˆ†
   
   es.md
   ```
   
7. å€’æ’ç´¢å¼•

   ```markdown
   ä»€ä¹ˆæ˜¯elasticsearch:
   ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“
   
   å€’æ’ç´¢å¼•:
   Term  => Term       => Posting
   Index    Dictionary    List
   Term å•è¯
   Term Index å•è¯ç´¢å¼•
   Term Dictionary å•è¯å­—å…¸
   Posting List å€’æ’åˆ—è¡¨
   
   id    name   gender  age  address
   1     å¼ ä¸‰      1     22   åŒ—äº¬å¸‚æœé˜³åŒº
   2     æå››      2     21   ä¸Šæµ·å¸‚å¾æ±‡åŒº
   3     ç‹äº”      1     23   ä¸Šæµ·å¸‚è™¹å£åŒº
   
   nameå­—æ®µ:
   Term  Posting List
   å¼ ä¸‰      1
   æå››      2
   ç‹äº”      3
   
   ageå­—æ®µ:
   Term  Posting List
   21       2
   22       1
   23       3
   
   genderå­—æ®µ:
   Term  Posting List
   1       [1,3]
   2         2
   
   addresså­—æ®µ:
   Term  Posting List
   åŒ—äº¬å¸‚   1
   ä¸Šæµ·å¸‚   [2,3]
   å¾æ±‡åŒº    2
   è™¹å£åŒº    3
   æœé˜³åŒº    1
   ```

8. é€šè¿‡pythonæ“ä½œeså¢åˆ æ”¹æŸ¥ & é€šè¿‡pythonæ“ä½œesæ‰¹é‡æ·»åŠ æ•°æ®

   ```markdown
   pip install elasticsearch==7.7.0 -i https://pypi.douban.com/simple
   elasticsearch_demo.py
   input_some_data.py
   ```
   
##### æ•°æ®å¯è§†åŒ–-kibana 1h42min
1. å‘eså¯¼å…¥ç¤ºä¾‹æ•°æ®

   ```markdown
   ä»€ä¹ˆæ˜¯Kibana:
   Kibanaæ˜¯ä¸€ä¸ªé’ˆå¯¹ESçš„å¼€å…ƒåˆ†æåŠå¯è§†åŒ–å¹³å°,ç”¨æ¥æœç´¢ã€æŸ¥çœ‹äº¤äº’å­˜å‚¨åœ¨ESç´¢å¼•ä¸­çš„æ•°æ®
   ä½¿ç”¨Kibana,å¯ä»¥é€šè¿‡å„ç§å›¾è¡¨è¿›è¡Œé«˜çº§æ•°æ®åˆ†æåŠå±•ç¤º

   ç¤ºä¾‹æ•°æ®: https://www.elastic.co/guide/cn/kibana/current/tutorial-load-dataset.html
   
   es.md
   ä¸Šä¼ shakespeare_6.0.jsonã€accounts.jsonã€logs.jsonlåˆ°ubuntu
   curl -H 'Content-Type: application/x-ndjson' -XPOST '192.168.0.101:9200/shakespeare/_doc/_bulk?pretty' --data-binary @shakespeare_6.0.json
   curl -H 'Content-Type: application/x-ndjson' -XPOST '192.168.0.101:9200/bank/account/_bulk?pretty' --data-binary @accounts.json
   curl -H 'Content-Type: application/x-ndjson' -XPOST '192.168.0.101:9200/_bulk?pretty' --data-binary @logs.jsonl
   æŠŠ,"_type":"log"æ›¿æ¢ä¸ºç©º
   ```

2. kibanaçš„index-pattern

   ```markdown
   ç´¢å¼•æ¨¡å¼(index pattern):
   ç´¢å¼•æ¨¡å¼æ˜¯kibanaç”¨æ¥ä»eså–æ•°æ®ä½¿ç”¨çš„
   192.168.0.101:5601
   Management-> ç´¢å¼•æ¨¡å¼ -> åˆ›å»ºç´¢å¼•æ¨¡å¼ -> å®šä¹‰ç´¢å¼•æ¨¡å¼ logstash* -> é…ç½®è®¾ç½® æ—¶é—´ç­›é€‰å­—æ®µåç§° @timestamp -> åˆ›å»ºç´¢å¼•æ¨¡å¼
   url  url.keyword ç¼–è¾‘ æ ¼å¼ URL ä¿å­˜å­—æ®µ
   ```

3. kibanaçš„discover

   ```markdown
   ç‚¹å‡»å°æ—¥å†-é€‰æ‹©æ—¶é—´ 2015-05-17 Update
   åå­—å˜å°æ‰‹ç‚¹å‡»æŸ±å½¢å›¾
   åå­—é€‰æ‹©å·¦å¤–ä¸‰ä¸ªæŸ±
   åå­—é€‰æ‹©é‡Œé¢ä¸‰ä¸ªæŸ±
   ç‚¹å‡»ä¸‹é¢å‘å³çš„ç®­å¤´æŸ¥è¯¢ä¸€æ¡æ•°æ®
   æœç´¢æ¡†æœç´¢geo.src.keyword:"CN" Updata
   
   Dev Tools
   GET logstash*/_search
   {
     "query": {
       "match": {
         "geo.src.keyword": "CN"
       }
     }
   }
   ç‚¹å‡»å°æ¿æ‰‹-è‡ªåŠ¨ç¼©è¿›-æ‹·è´:
   {"match":{"geo.src.keyword":"CN"}}
   
   Discover
   æœç´¢æ¡†æœç´¢ {"match":{"geo.src.keyword":"CN"}} KQLå…³é—­ Refresh   Lucene
   
   ç‚¹å‡»æ·»åŠ ç­›é€‰-å­—æ®µ@tags è¿ç®—ç¬¦ æ˜¯  å€¼ warning ä¿å­˜
   
   ç‚¹å‡»ç­›é€‰æ¡ä»¶-ç¼–è¾‘ç­›é€‰ã€æ’é™¤ç»“æœ(å–å)ã€æš‚æ—¶ç¦ç”¨ã€åˆ é™¤ã€åœ¨æ‰€æœ‰åº”ç”¨å›ºå®š-Refresh
   
   é€‰å®šå­—æ®µ-_source
   
   å¯ç”¨å­—æ®µ-tags agent clientip geo.src +
   
   ç‚¹å‡»ä¸‹é¢å‘å³çš„ç®­å¤´æŸ¥è¯¢ä¸€æ¡æ•°æ® è¡¨: é¼ æ ‡æ”¾åˆ°@message + ç­›ç•™å€¼ - ç­›é™¤å€¼ å°ä¹¦-åœ¨è¡¨ä¸­åˆ‡æ¢åˆ— æ–‡æ¡£+å­—æ®µæ˜¯å¦å­˜åœ¨ç­›é€‰ JSON
   æŸ¥çœ‹å‘¨å›´æ–‡æ¡£ æŸ¥çœ‹å•ä¸ªæ–‡æ¡£
   ```

4. esèšåˆåˆ†æ-pipeline

   ```markdown
   pipeline:
   ç®¡é“èšåˆåˆ†æ,æ”¯æŒå¯¹èšåˆåˆ†æçš„ç»“æœå†æ¬¡è¿›è¡Œèšåˆåˆ†æ,æ”¯æŒé“¾å¼è°ƒç”¨
   
   Sibling-ç»“æœå’Œç°æœ‰åˆ†æç»“æœåŒçº§
   max / min / avg & sum bucket
   stats / extended stats bucket
   percentiles bucket
   
   Parent - ç»“æœå†…åµŒåˆ°ç°æœ‰çš„èšåˆåˆ†æç»“æœä¹‹ä¸­
   Derivate-æ±‚å¯¼
   Cumultive Sum-ç´¯è®¡æ±‚å’Œ
   Moving Function-ç§»åŠ¨å¹³å‡
   
   èšåˆåˆ†ææ ·ä¾‹æ•°æ®.txt
   es.md
   ```

5. kibanaçš„visualizeåŸºæœ¬å›¾å½¢-æŠ˜çº¿å›¾

   ```markdown
   Visualize-æ–°å»ºå¯è§†åŒ–-é¢ç§¯å›¾-é€‰æ‹©logstash*
   å³è¾¹-æŒ‡æ ‡-Yè½´
   å³è¾¹-å­˜å‚¨æ¡¶-æ·»åŠ Xè½´-èšåˆ Date Histogram-æœ€å°æ—¶é—´é—´éš” 3h-å®šåˆ¶æ ‡ç­¾ æ—¥æœŸ-æ›´æ–°
   å³è¾¹-å­˜å‚¨æ¡¶-æ·»åŠ -æ‹†åˆ†åºåˆ—-å­èšåˆ è¯ -å­—æ®µ geo.src.keyword-æ›´æ–°
   å³è¾¹-å­˜å‚¨æ¡¶-Xè½´/æ‹†åˆ†åºåˆ—æŠ˜èµ·æ¥-å¯ç”¨/ç¦ç”¨èšåˆã€æ‹–æ‹‰é€‰æ‹©ä¼˜å…ˆçº§-æ›´æ–°
   å³è¾¹-å­˜å‚¨æ¡¶-æ·»åŠ -æ‹†åˆ†å›¾è¡¨-è¡Œ-å­èšåˆ è¯ -å­—æ®µ geo.src.keyword-æ›´æ–°
   æ‹†åˆ†åºåˆ—->æ‹†åˆ†å›¾è¡¨->Xè½´
   å³è¾¹-å­˜å‚¨æ¡¶-æ·»åŠ -æ‹†åˆ†å›¾è¡¨-å­—æ®µ-å­èšåˆ è¯ -å­—æ®µ geo.src.keyword-æ›´æ–°
   å³è¾¹-æŒ‡æ ‡-Yè½´-æ·»åŠ ç‚¹å¤§å°-èšåˆ å”¯ä¸€è®¡æ•°-å­—æ®µ clientip.keyword  4%-æ›´æ–°
   å³è¾¹-æŒ‡æ ‡å’Œè½´-å›¾è¡¨ç±»å‹ æŠ˜çº¿å›¾-æ¨¡å¼å †å 
   ```

6. kibanaçš„visualizeåŸºæœ¬å›¾å½¢-çƒ­åŠ›å›¾

   ```markdown
   Visualize->æ–°å»ºå¯è§†åŒ–->çƒ­åŠ›å›¾->é€‰æ‹©logstash*-2015/05/18 00:00:00 - 2015/05/22 23:30:00
   å³è¾¹-æ•°æ®-æŒ‡æ ‡ã€å­˜å‚¨æ¡¶-Xè½´-èšåˆ Date Histogram-æœ€å°æ—¶é—´é—´éš” 3h-å­—æ®µ@timestamp-æ›´æ–°
   å³è¾¹-æ•°æ®-æŒ‡æ ‡ã€å­˜å‚¨æ¡¶-Yè½´-å­èšåˆ è¯ -å­—æ®µ geo.src.keyword-å¤§å° 15-æ›´æ–°
   Yè½´-Xè½´
   é€‰é¡¹-é¢œè‰²æ¨¡å¼-é»„åˆ°çº¢
   ```

7. kibanaçš„visualizeåŸºæœ¬å›¾å½¢-é¥¼å›¾

   ```markdown
   Visualize->æ–°å»ºå¯è§†åŒ–->é¥¼å›¾->é€‰æ‹©logstash*-2015/05/18 00:00:00 - 2015/05/22 23:30:00
   å³è¾¹-æ•°æ®-æŒ‡æ ‡ã€å­˜å‚¨æ¡¶-æ‹†åˆ†åˆ‡ç‰‡-èšåˆ è¯ -å­—æ®µ geo.src.keyword-å¤§å° 15-æ›´æ–°
   å³è¾¹-æ•°æ®-æŒ‡æ ‡ã€å­˜å‚¨æ¡¶-æ‹†åˆ†åˆ‡ç‰‡-èšåˆ è¯ -å­—æ®µ ip.keyword-å¤§å° 5-æ›´æ–°
   é€‰é¡¹-æ˜¾ç¤ºæ ‡ç­¾ã€é¥¼å›¾è®¾ç½® åœ†ç¯å›¾
   ```

8. kibanaçš„visualizeåŸºæœ¬å›¾å½¢-æ•°æ®è¡¨

   ```markdown
   Visualize->æ–°å»ºå¯è§†åŒ–->æ•°æ®è¡¨->é€‰æ‹©logstash*-2015/05/18 00:00:00 - 2015/05/22 23:30:00
   å³è¾¹-æ•°æ®-æŒ‡æ ‡ã€å­˜å‚¨æ¡¶-æ‹†åˆ†è¡Œ-èšåˆ Date Histogram-æœ€å°æ—¶é—´é—´éš” æ¯æ—¥-å­—æ®µ@timestamp-æ›´æ–°
   å³è¾¹-æ•°æ®-æŒ‡æ ‡ã€å­˜å‚¨æ¡¶-æ‹†åˆ†è¡Œ-å­èšåˆ è¯ -å­—æ®µ geo.src.keyword-å¤§å° 5-æ›´æ–°
   é€‰é¡¹-æ¯é¡µæœ€å¤§è¡Œæ•° 20
   ```

9. kibanaçš„visualizeåŸºæœ¬å›¾å½¢-ä»ªè¡¨ç›˜

   ```markdown
   Visualize->æ–°å»ºå¯è§†åŒ–->ä»ªè¡¨ç›˜å›¾->é€‰æ‹©logstash*-2015/05/18 00:00:00 - 2015/05/22 23:30:00
   é€‰é¡¹-èŒƒå›´ 0-4000 4000-8000 8000-12000 12000-16000-æ›´æ–°
   ```

10. kibanaçš„visualizeåŸºæœ¬å›¾å½¢-ç›®æ ‡å›¾ 

   ```markdown
   Visualize->æ–°å»ºå¯è§†åŒ–->ç›®æ ‡å›¾->é€‰æ‹©logstash*-2015/05/18 00:00:00 - 2015/05/22 23:30:00
   é€‰é¡¹-èŒƒå›´ ç™¾åˆ†æ¯”æ¨¡å¼å…³é—­  0-2000 ... æ·»åŠ èŒƒå›´ ... 18000-20000 -æ›´æ–°
   å³è¾¹-æ•°æ®-æŒ‡æ ‡ã€å­˜å‚¨æ¡¶-æ‹†åˆ†ç»„-èšåˆ è¯ -å­—æ®µ geo.src.keyword-å¤§å° 5-æ›´æ–°
   ```

11. kibanaçš„visualizeçš„timelion

   ```markdown
   Timelion:
   Timelionæ˜¯ä¸€ä¸ªæ—¶é—´åºåˆ—æ•°æ®çš„å¯è§†åŒ–,å¯ä»¥ç»“åˆåœ¨ä¸€ä¸ªå•ä¸€çš„å¯è§†åŒ–å®Œå…¨ç‹¬ç«‹çš„æ•°æ®æº.å®ƒæ˜¯ç”±ä¸€ä¸ªç®€å•çš„è¡¨è¾¾å¼è¯­è¨€é©±åŠ¨çš„,ç”¨æ¥æ£€ç´¢æ—¶é—´åºåˆ—æ•°æ®,
   è¿›è¡Œè®¡ç®—,ç„¶åå¯è§†åŒ–ç»“æœ
   
   Timelionå¯ä»¥è§£å†³å“ªäº›é—®é¢˜:
   æ¯ä¸ªå”¯ä¸€ç”¨æˆ·åœ¨ä¸€æ®µæ—¶é—´å†…æŸ¥çœ‹å¤šå°‘é¡µ
   æœ¬å‘¨äº”å’Œä¸Šå‘¨äº”ä¹‹é—´çš„æµé‡æœ‰ä»€ä¹ˆä¸åŒ
   æ—¥æœ¬ç™¾åˆ†ä¹‹å‡ çš„äººå£ä»Šå¤©æ¥åˆ°æˆ‘çš„ç½‘ç«™
   æ ‡å‡†æ™®å°”500æŒ‡æ•°10æ—¥ç§»åŠ¨å¹³å‡çº¿æ˜¯å¤šå°‘
   è¿‡å»ä¸¤å¹´å†…æ”¶åˆ°çš„æ‰€æœ‰æœç´¢è¯·æ±‚ç´¯è®¡æ€»å’Œæ˜¯å¤šå°‘
   
   æ•°æ®æºè®¾å®šç±»:
   .elasticsearch(): ä»ESè¯»å–æ•°æ®
   .es(q="querystring",metric="cardinality:uid",index="logstash-*",offset="-1d"):.elasticsearch()çš„ç®€å†™
   .graphite(metric="path.to.*.data",offset="-1d"):ä»graphiteè¯»å–æ•°æ®
   .quandl(): ä»quandlè¯»å–quandlç 
   .worldbank_indicators():ä»worldbank.orgè¯»å–å›½å®¶æ•°æ®
   .wbi():.worldbank_indicators()çš„ç®€å†™
   .worldbank():ä»worldbank.orgè¯»å–æ•°æ®
   .wb(): .worldbank()çš„ç®€å†™
   
   å¯è§†åŒ–æ•ˆæœç±»:
   .bars($width):ç”¨æŸ±çŠ¶å›¾å±•ç¤ºæ•°ç»„
   .lines($width,$fill,$show,$steps):ç”¨æŠ˜çº¿å›¾å±•ç¤ºæ•°ç»„
   .point():ç”¨æ•£ç‚¹å›¾å±•ç¤ºæ•°ç»„
   .color("#c6c6c6"):æ”¹å˜é¢œè‰²
   .hide():éšè—è¯¥æ•°ç»„
   .label("change from %s"):æ ‡ç­¾
   .legend($position, $column):å›¾ä¾‹ä½ç½®
   .static(value=1024,label="1k",offset="-1d", fit="scale"): åœ¨å›¾å½¢ä¸Šç»˜åˆ¶ä¸€ä¸ªå›ºå®šå€¼
   .value(): .static()çš„ç®€å†™
   .title(title="qps"):å›¾æ ‡æ ‡é¢˜
   .trend(mode="linear",start=0,end=-10):é‡‡ç”¨linearæˆ–logå›å½’ç®—æ³•ç»˜åˆ¶è¶‹åŠ¿å›¾
   .yaxis($yaxis_number,$min,$max, $position):è®¾ç½®Yè½´å±æ€§,.yaxis(2)è¡¨ç¤ºç¬¬äºŒæ ¹Yè½´
   
   æ•°æ®è¿ç®—ç±»:
   .abs():å¯¹æ•´ä¸ªæ•°ç»„å…ƒç´ æ±‚ç»å¯¹å€¼
   .precision($number):æµ®ç‚¹æ•°ç²¾åº¦
   .cusum($base):æ•°ç»„å…ƒç´ ä¹‹å’Œ,å†åŠ ä¸Š$base
   .derivative():å¯¹æ•°ç»„æ±‚å¯¼æ•°
   .divide($divisor):æ•°ç»„å…ƒç´ é™¤æ³•
   .multiply($multiplier): æ•°ç»„å…ƒç´ ä¹˜æ³•
   .subtract($term):æ•°ç»„å…ƒç´ å‡æ³•
   .sum($term):æ•°ç»„å…ƒç´ åŠ æ³•
   .add():åŒ.sum()
   .plus(): åŒsum()
   .first(): è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ 
   .movingaverage($window): ç”¨æŒ‡å®šçš„çª—å£å¤§å°è®¡ç®—ç§»åŠ¨å¹³å‡å€¼
   .mvavg():.movingaverage()çš„ç®€å†™
   .movingstd($window):ç”¨äºæŒ‡å®šçš„çª—å£å¤§å°è®¡ç®—ç§»åŠ¨æ ‡å‡†å·®
   .mvstd():.movingstd()çš„ç®€å†™
   .fit($mode): ä½¿ç”¨æŒ‡å®šçš„fitå‡½æ•°å¡«å……ç©ºå€¼,å¯é€‰é¡¹æœ‰: average,carry,nearest,none,scale
   .holt(alpha=0.5, beta=0.5, gamma=0.5,season="1w",sample=2):å³ESçš„pipeline aggregationæ‰€æ”¯æŒçš„holt-wintersç®—æ³•
   .log(base=10):å¯¹æ•°
   .max(): æœ€å¤§å€¼
   .min(): æœ€å°å€¼
   .props(): é™„åŠ é¢å¤–å±æ€§,æ¯”å¦‚.props(label=bears!)
   .range(max=10,min=1):ä¿æŒå½¢çŠ¶çš„å‰æä¸‹ä¿®æ”¹æœ€å¤§å€¼æœ€å°å€¼
   .scale_interval(interval="1s"): åœ¨æ–°é—´éš”ä¸‹å†æ¬¡ç»Ÿè®¡,æ¯”å¦‚æŠŠä¸€ä¸ªåŸæœ¬5miné—´éš”çš„date_histogramæ”¹ä¸ºæ¯ç§’çš„ç»“æœ
   .trim(start=1, end=-1):è£å‰ªåºåˆ—å€¼
   
   é€»è¾‘è¿ç®—ç±»:
   .condition(operator="eq",if=100,then=200):æ”¯æŒeqã€neã€ltã€gtã€lteã€gteç­‰æ“ä½œç¬¦,ä»¥åŠifã€elseã€thenèµ‹å€¼
   .if(): .condition()çš„ç®€å†™
   
   Visualize->æ–°å»ºå¯è§†åŒ–-Timelion->é€‰æ‹©logstash*-2015/05/18 00:00:00 - 2015/05/22 23:30:00
   Timelionè¡¨è¾¾å¼:
   .es(index=logstash*,metric=count)
   
   .es(index=logstash*,metric=count,offset=-1d)
   
   .es(index=logstash*,metric=count,offset=-1d),.es(index=logstash*,metric=count)
   
   .es(index=logstash*,metric=count,offset=-1d).label("æ˜¨æ—¥"),.es(index=logstash*,metric=count).label("ä»Šæ—¥")
   
   .es(index=logstash*,metric=count,offset=-1d).label("æ˜¨æ—¥"),.es(index=logstash*,metric=count).label("ä»Šæ—¥").title("è®¿é—®ç»Ÿè®¡")
   
   .es(index=logstash*,metric=count,offset=-1d).label("æ˜¨æ—¥").lines(fill=1,width=0.5),.es(index=logstash*,metric=count).label("ä»Šæ—¥").title("è®¿é—®ç»Ÿè®¡")
   
   .es(index=logstash*,metric=count,offset=-1d).label("æ˜¨æ—¥").lines(fill=1,width=0.5).color(gray),.es(index=logstash*,metric=count).label("ä»Šæ—¥").title("è®¿é—®ç»Ÿè®¡")
   
   .es(index=logstash*,metric=count,offset=-1d).label("æ˜¨æ—¥").lines(fill=1,width=0.5).color(gray),.es(index=logstash*,metric=count).label("ä»Šæ—¥").title("è®¿é—®ç»Ÿè®¡").color(#1E90FF)
   
   .es(index=logstash*,metric=count,split=geo.src.keyword:3,)
   
   .es(index=logstash*,q="geo.src.keyword:CN",metric=count,split=machine.os.keyword:3,)
   
   .es(index=logstash*,metric=sum:bytes,offset=-1d).label("æ˜¨æ—¥"),.es(index=logstash*,metric=sum:bytes).label("ä»Šæ—¥")
   
   .es(index=logstash*,metric=sum:bytes,offset=-1d).label("æ˜¨æ—¥"),.es(index=logstash*,metric=sum:bytes).label("ä»Šæ—¥"),
   .static(1000000).label("å‘Šè­¦çº¿").color("red")
   
   .es(index=logstash*).label("è¯·æ±‚è®¡æ•°")
   
   .es(index=logstash*).label("è¯·æ±‚è®¡æ•°"),
   .es(index=logstash*,
   metric=sum:bytes).label("æµé‡è®¡æ•°")
   
   (.es(index=logstash*).label("è¯·æ±‚è®¡æ•°"),
   .es(index=logstash*,
   metric=sum:bytes).label("æµé‡è®¡æ•°"))
   .range(0,10000)
   ```

##### å®æ—¶æ•°æ®å›¾è¡¨åˆ†æ & è¯¾ç¨‹æ€»ç»“  
1. çŸ­è§†é¢‘æ•°æ®è§£æå…¥åº“ & çŸ­è§†é¢‘æ•°æ®åˆ†æé¡¹ç›®å®æˆ˜

   ```markdown
   # çŸ­è§†é¢‘æ•°æ®åˆ†æé¡¹ç›®å®æˆ˜
   nickname.txt
   tag.txt
   ä¸ªæ€§ç­¾å.txt
   handle_data.py

   ç´¢å¼•æ¨¡å¼: douyin_data*
   192.168.0.101:5601
   Management-> ç´¢å¼•æ¨¡å¼ -> åˆ›å»ºç´¢å¼•æ¨¡å¼ -> å®šä¹‰ç´¢å¼•æ¨¡å¼ douyin_data* -> é…ç½®è®¾ç½® æ—¶é—´ç­›é€‰å­—æ®µåç§° crawl_time-> åˆ›å»ºç´¢å¼•æ¨¡å¼
   
   Discover
   æ—¶é—´:2020/07/01 07:59:20-2020/08/10 08:53:23 æ¯æ—¥
   
   Visualize->æ–°å»ºå¯è§†åŒ–-å‚ç›´æ¡å½¢å›¾->é€‰æ‹©douyin_data*-2020/07/01 07:59:20-2020/08/10 08:53:23
   å³è¾¹-æ•°æ®-å­˜å‚¨æ¡¶-Xè½´-èšåˆ Date Histogram-æœ€å°æ—¶é—´é—´éš” æ¯æ—¥-å­—æ®µcrawl_time-æ›´æ–°
   æ¯å¤©æ•°æ®æŠ“å–åˆ†å¸ƒå›¾
   
   Visualize->æ–°å»ºå¯è§†åŒ–-é¥¼å›¾->é€‰æ‹©douyin_data*-2020/07/01 07:59:20-2020/08/10 08:53:23
   å³è¾¹-æ•°æ®-å­˜å‚¨æ¡¶-æ‹†åˆ†åˆ‡ç‰‡-èšåˆ Date Histogram-æœ€å°æ—¶é—´é—´éš” æ¯å¹´-å­—æ®µbirthday-æ›´æ–°
   å³è¾¹-æ•°æ®-å­˜å‚¨æ¡¶-æ‹†åˆ†åˆ‡ç‰‡-å­èšåˆ è¯ -å­—æ®µ gender-å¤§å° 5-æ›´æ–°
   gender=>birthday
   é€‰é¡¹-é¥¼å›¾è®¾ç½® åœ†ç¯å›¾
   å¹´é¾„å’Œæ€§åˆ«åˆ†å¸ƒé¥¼å›¾
   
   Visualize->æ–°å»ºå¯è§†åŒ–-æ ‡ç­¾äº‘å›¾->é€‰æ‹©douyin_data*-2020/07/01 07:59:20-2020/08/10 08:53:23
   å³è¾¹-æ•°æ®-å­˜å‚¨æ¡¶-æ ‡è®°-èšåˆ è¯ -å­—æ®µ tag.keyword-å¤§å° 15-æ›´æ–°
   é€‰é¡¹-æ–¹å‘ å¤šä¸ª
   æ ‡ç­¾è¯äº‘å›¾
   
   Visualize->æ–°å»ºå¯è§†åŒ–->ç›®æ ‡å›¾->é€‰æ‹©douyin_data*-2020/07/01 07:59:20-2020/08/10 08:53:23
   é€‰é¡¹-èŒƒå›´ ç™¾åˆ†æ¯”æ¨¡å¼å…³é—­  0-10000 ... æ·»åŠ èŒƒå›´ ... 100000-110000 -æ›´æ–°
   å³è¾¹-æ•°æ®-å­˜å‚¨æ¡¶-æ‹†åˆ†ç»„-èšåˆ è¯ -å­—æ®µ region.keyword-å¤§å° 5-æ›´æ–°
   æŒ‰åœ°åŒºåˆ†å¸ƒç»Ÿè®¡
   
   åˆ›å»ºä»ªè¡¨æ¿ æŠ–éŸ³çŸ­è§†é¢‘æ•°æ®åˆ†æ(æ‰“å¼€ å°†æ—¶é—´éšä»ªè¡¨ç›˜ä¿å­˜)-æ·»åŠ æ¯å¤©æ•°æ®æŠ“å–åˆ†å¸ƒå›¾-æ·»åŠ å¹´é¾„å’Œæ€§åˆ«åˆ†å¸ƒé¥¼å›¾-æ·»åŠ æ ‡ç­¾è¯äº‘å›¾-æ·»åŠ æŒ‰åœ°åŒºåˆ†å¸ƒç»Ÿè®¡-æ·»åŠ ipå’ŒæŠ“å–æ•°æ®åˆ†å¸ƒ
   
   # çŸ­è§†é¢‘æ•°æ®è§£æå…¥åº“
   ubuntuè¿œç¨‹è™šæ‹Ÿç¯å¢ƒæ­å»º
   mitmdump_es.py
   
   ubuntuè™šæ‹Ÿæœºä¸æ‰‹æœºå¤„äºåŒä¸€ä¸ªç½‘ç»œ
   1) ubuntuè™šæ‹Ÿæœº æ¡¥æ¥ç½‘ç»œ
   2) æ‰‹æœºå®‰è£…mitmproxyè¯ä¹¦å¹¶ä¿¡ä»» mitm.it  æ‰‹æœºè®¾ç½®mitmproxyä»£ç† 192.168.0.110/[192.168.0.101 8889]
   
   mitmdump -s mitmdump_es.py -p 8889
   GET _cat/indices 
   å¯åŠ¨åˆ·æ–°æŠ–éŸ³ / å¯åŠ¨handle_douyin.py
   æŸ¥çœ‹mitmdumpæ˜¯å¦æœ‰æ•°æ®è¾“å‡º
   GET _cat/indices æŸ¥çœ‹æ˜¯å¦æœ‰douyin_data_2020-08-09
   GET douyin_data_2020-08-09/_search{
   "query":{
   "match_all":{
   }
   }
   }
   åœ¨Kibanaä¸­è¿›è¡Œæ•°æ®åˆ†æ(åŒä¸ŠèŠ‚)
   ```
   
2. è¯¾ç¨‹æ€»ç»“

   ```markdown
   ä»€ä¹ˆæ˜¯Uiautomator2
   Uiautomator2çš„é€šä¿¡æµç¨‹
   u2è‡ªåŠ¨åŒ–æŠ“å–ç¯å¢ƒçš„æ­å»º
   u2è¿æ¥ç§»åŠ¨è®¾å¤‡ä¸‰ç§æ–¹å¼
   
   å®šä½å…ƒç´ æ–¹æ³•
   weditorå·¥å…·å®‰è£…å’Œä½¿ç”¨
   å®æˆ˜-è§£é”ç§»åŠ¨è®¾å¤‡ä¹å®«æ ¼
   å®æˆ˜-è€ƒç ”å¸®appç™»é™†å’Œæ»‘åŠ¨è€ƒç ”èµ„è®¯
   
   Fiddler/mitmproxyæŠ“åŒ…å·¥å…·ä½¿ç”¨
   Appæ— æ³•æŠ“åŒ…æ¢ç§˜
   
   é€šè¿‡u2å®ç°æ»‘åŠ¨æŠ–éŸ³çŸ­è§†é¢‘
   é€šè¿‡mitmproxyè§£ææŠ–éŸ³çŸ­è§†é¢‘æ•°æ®
   
   ä»€ä¹ˆæ˜¯atxserver2åº“
   å®ç°å¤šä»»åŠ¡ç«¯appåº”ç”¨æŠ“å–ç³»ç»Ÿ
   
   ESå®‰è£…å’ŒåŸºæœ¬çš„å¢åˆ æ”¹æŸ¥
   ESæŸ¥è¯¢è¿›é˜¶
   ESçš„mappings
   ESçš„åˆ†è¯
   ESçš„å€’æ’ç´¢å¼•
   é€šè¿‡Pythonå¯¹ESæ‰¹é‡æ·»åŠ æ•°æ®
   
   å‘ESå¯¼å…¥ç¤ºä¾‹æ•°æ®
   Kibanaçš„index-pattern
   Kibanaçš„Discover
   ESçš„èšåˆåˆ†æ
   Kibanaçš„åŸºæœ¬å›¾å½¢
   
   çŸ­è§†é¢‘æ•°æ®è§£æå…¥åº“
   å®æˆ˜-æŠ–éŸ³çŸ­è§†é¢‘æ•°æ®åˆ†æ
   ```



















